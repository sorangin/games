:root {

    .profile-display-bar {
        position: absolute;
        bottom: 15px;
        right: 20px;
        z-index: 1001;
        display: flex;
        align-items: center;
    }

    .profile-name-button {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--border-gold-weak);
        color: var(--color-gold-light);
        padding: 6px 15px;
        border-radius: 6px;
        font-family: inherit;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
    }

    .profile-name-button:hover {
        background: var(--bg-gold-weak);
        border-color: var(--color-gold-light);
        box-shadow: 0 0 10px var(--border-gold-weak);
        transform: translateY(-2px);
        color: var(--color-gold-light);
    }

    .mini-button {
        padding: 4px 10px;
        font-size: 0.85rem;
        border-radius: 4px;
    }

    /* Accounts Overlay */
    .accounts-content {
        max-width: 800px;
        background: var(--color-wood-dark);
        border: 3px solid var(--color-gold-dark);
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.9), inset 0 0 60px rgba(0, 0, 0, 0.6);
        padding: 40px;
        border-radius: 12px;
    }

    .profiles-list {
        margin: 25px 0;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 15px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* Removed malformed .profile.shop-bottom-bar block */

    /* Removed malformed .profile.shop-bottom-bar block */

    .profile-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 24px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-gold-weak);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-bottom: 8px;
    }

    .p-info {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-grow: 1;
    }

    .p-sprite-container {
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        border-radius: 0;
        background: transparent;
        overflow: visible;

        background-image: var(--spritesheet-icons);
        background-position: 75% 25%;
        /* Row 1, Col 3 */
        background-size: 500% 500%;
    }

    .p-knight-sprite {
        width: 32px;
        height: 32px;
        image-rendering: pixelated;
        transform: scale(1.6);
        position: relative;
    }

    .p-gear-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .p-details {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .profile-item:hover {
        background: var(--bg-gold-weak);
        border-color: var(--color-gold-light);
        transform: translateX(5px);
    }

    .profile-item:hover .p-name {
        color: var(--color-gold-light);
    }

    .profile-item.active {
        background: var(--bg-gold-strong);
        /* Keeping slightly stronger or use var? */
        border-color: var(--color-gold-light);
        box-shadow: 0 0 10px var(--border-gold-weak);
    }

    .profile-item .p-name {
        color: var(--color-text-main);
        font-size: 1.1rem;
    }

    .hidden {
        display: none !important;
    }

    .profile-item.active .p-name {
        color: var(--color-gold-light);
        font-weight: bold;
    }

    .hotkey-highlight {
        color: var(--color-gold-light);
        font-weight: bold;
    }

    .no-backdrop {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 10px !important;
        min-width: unset !important;
        height: auto !important;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, filter 0.2s;
    }

    .no-backdrop:hover {
        background: transparent !important;
        transform: scale(1.15);
        filter: brightness(1.3);
    }

    .no-backdrop .icon-icons,
    .no-backdrop .icon-short {
        margin: 0 !important;
    }

    .with-backdrop {
        position: relative;
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
    }

    .with-backdrop::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 1.3em;
        height: 1.3em;
        background-image: var(--spritesheet-icons);
        background-size: 400% 500%;
        background-position: 100% 25%;
        /* r1, c3 */
        z-index: 0;
        opacity: 0.95;
        image-rendering: pixelated;
    }

    .with-backdrop .icon-icons,
    .with-backdrop .icon-short {
        position: relative;
        z-index: 1;
    }

    .large-icon {
        font-size: 4.5rem !important;
    }

    .large-icon.icon-icons {
        width: 128px !important;
        height: 128px !important;
    }

    .dropshadow {
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.9)) drop-shadow(0 0 2px rgba(0, 0, 0, 1));
    }

    .soft-shadow {
        filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 1px rgba(0, 0, 0, 0.7));
    }

    .miniature-icon-shadow {
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.6));
    }

    .nav-icon.icon-icons {
        width: 56px !important;
        height: 56px !important;
        font-size: 2.2rem !important;
        transition: transform 0.2s;
    }


    .nav-icon.icon-icons:hover {
        transform: scale(1.1);
    }


    .main-menu-center-box {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding-top: 41vh;
    }

    .main-menu-bottom-bar {
        position: absolute;
        bottom: 25px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 40px;
        box-sizing: border-box;
        pointer-events: none;
    }

    .bottom-bar-left,
    .bottom-bar-right {
        display: flex;
        gap: 10px;
        pointer-events: auto;
    }

    .active-tab-icon {
        filter: drop-shadow(0 0 15px var(--color-gold-light)) brightness(1.4) !important;
        transform: scale(1.1);
    }

    .sprite-button {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        cursor: pointer;
        transition: transform 0.2s ease, filter 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        outline: none;
        appearance: none;
        -webkit-appearance: none;
    }

    .sprite-button img {
        max-width: clamp(200px, 40vw, 400px);
        height: auto;
        filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.8));
    }

    .sprite-button:hover {
        transform: scale(1.05);
        filter: brightness(1.2) drop-shadow(0 0 15px rgba(255, 215, 0, 0.4));
    }

    .sprite-button:active {
        transform: scale(0.95);
        filter: brightness(0.9);
    }

    .delete-profile-btn {
        background: var(--bg-dark-red-weak);
        border: 1px solid var(--border-dark-red);
        color: #ff6666;
        width: 28px;
        height: 28px;
        display: none;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s ease;
        padding: 0;
        line-height: 1;
        margin: 0 0 0 10px;
        min-width: 28px;
    }

    .profile-item:hover .delete-profile-btn {
        display: flex;
    }

    .delete-profile-btn:hover {
        background: rgba(139, 0, 0, 0.5);
        border-color: #ff3333;
        color: white;
        box-shadow: 0 0 8px rgba(139, 0, 0, 0.6);
        transform: scale(1.1);
    }

    .profile-item .p-status {
        font-size: 0.95rem;
        color: var(--color-text-muted);
        background: rgba(0, 0, 0, 0.3);
        padding: 4px 12px;
        border-radius: 4px;
        border: 1px solid var(--bg-gold-weak);
        white-space: nowrap;
    }

    .accounts-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
    }

    /* Miniature Input Modal */
    .miniature-content {
        max-width: 450px !important;
        min-width: 300px;
        width: 90% !important;
        padding: 0 !important;
    }

    .miniature-content .overlay-scroll-container {
        padding: 2.5rem 2rem 1.5rem 2rem !important;
        gap: 1.2rem;
    }

    .miniature-title {
        font-size: clamp(1.8rem, 5vmin, 2.2rem) !important;
        padding: 0.4rem 1.5rem !important;
        margin-bottom: 0.5rem !important;
    }

    .miniature-content .inset-panel {
        width: 100%;
        padding: 1.5rem;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--color-wood-light);
        border-radius: 8px;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    #new-profile-name-input {
        width: 100%;
        padding: 14px;
        margin: 0;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--color-gold-dark);
        color: var(--color-text-main);
        border-radius: 6px;
        font-size: 1.1rem;
        text-align: center;
        transition: all 0.2s ease;
    }

    #new-profile-name-input:focus {
        outline: none;
        border-color: var(--color-gold-light);
        box-shadow: 0 0 12px rgba(253, 181, 0, 0.5);
        background: rgba(0, 0, 0, 0.7);
    }

    .modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    /* Game Variables */
    font-size: clamp(10px, 2vmin, 16px);
    --cell-size: 40px;
    --grid-cols: 8;
    --grid-rows: 10;
    --board-aspect-ratio: calc(var(--grid-cols, 8) / var(--grid-rows, 10));
    --ui-panel-width: clamp(22%, 28vmin, 340px);

    --death-fade-duration: 1s;
    --death-visible-duration: 5s;
    --attack-anim-time: 0.1s;
    --move-anim-time: 0.25s;
    --arrow-fly-time: 0.3s;
    --net-fly-time: 0.4s;
    --fireball-fly-time: 0.4s;
    --fireball-explode-time: 0.8s;
    --flame-wave-stagger-delay: 50ms;
    --flame-wave-preview-time: 1s;
    --flame-wave-effect-delay: 1000ms;
    --obstacle-destroy-time: 0.3s;
    --item-pickup-anim-time: 0.3s;
    --item-magnet-fly-time: 0.5s;
    --popup-duration: 1.1s;
    --frost-nova-expand-time: 0.5s;
    --frost-visual-fade-offset: 300ms;
    --mobile-tooltip-fade-time: 1s;

    --color-wood-dark: #4a3c2a;
    --color-wood-darkest: var(--color-wood-dark);
    /* Merged */
    --color-wood-base: var(--color-wood-dark);
    /* Merged */
    --color-wood-light: #8d7b6a;
    --color-iron-black: #212121;
    --color-iron-dark: var(--color-iron-black);
    /* Merged */
    --color-iron-medium: #525252;
    --color-iron-highlight: #bdbdbd;

    /* --- Standardized Palette --- */
    /* Gold */
    --color-gold-base: #b8860b;
    --color-gold-dark: var(--color-gold-base);
    /* Merged */
    --color-gold-light: #ffbb00;
    --color-gold-highlight: var(--color-gold-light);
    --color-gold: var(--color-gold-light);
    /* Added for strict unification */

    /* Orange */
    --color-orange-base: #cd670f;
    --color-orange-dark: var(--color-orange-base);
    /* Merged */
    --color-orange-highlight: #f0a52c;
    --color-orange-text: #fff;
    --color-orange-shadow: #8a3600;

    /* Red */
    --color-red-bright: #ff4444;
    --color-red-base: #D22B2B;
    /* Ember Armor Red */
    --color-accent-red: var(--color-red-base);
    /* Merged */
    --color-red-dark: #800000;

    --color-legendary: var(--color-orange-highlight);

    /* Green */
    --color-green-bright: #21f301;
    --color-green-base: #228B22;
    /* Forest Armor Green */
    --color-accent-green: var(--color-green-base);
    /* Merged */
    --color-green-dark: #2e5c30;
    --color-success: #55b014;

    /* Blue */
    --color-blue-bright: #286cff;
    --color-blue-base: #007FFF;
    /* Azure Armor Blue */
    --color-blue-light: #87ceeb;
    --color-accent-blue: var(--color-blue-light);
    /* Merged into light */
    --color-info: var(--color-blue-light);

    /* Magic/Effects (Cyan) */
    --color-cyan-bright: #00ffff;
    --color-cyan-glow: #0088ff;
    --color-cyan-soft: #88ddff;

    /* Purple (Epic/Rare) */
    --color-purple-bright: #9f01de;

    /* Neutrals */
    --color-text-main: #e8e0d0;
    --color-text-header: var(--color-gold-light);
    --color-text-muted: #b0a595;
    --color-text-shadow: rgba(0, 0, 0, 0.75);

    /* UI States */
    --color-disabled-bg: var(--color-iron-medium);
    --color-disabled-border: var(--color-iron-black);
    --color-disabled-text: #9e9e9e;
    /* Keep unique? Or map to highlight? */
    --color-error: var(--color-red-base);

    --color-border-highlight: rgba(255, 255, 255, 0.09);
    --color-border-shadow: rgba(0, 0, 0, 0.45);

    --hp-bar-bg: var(--color-iron-medium);
    --hp-bar-border: var(--color-iron-black);
    --hp-high: var(--color-green-base);
    --hp-mid: var(--color-gold-light);
    --hp-low: var(--color-red-base);

    --color-dot-locked-bg: var(--color-iron-medium);
    --color-dot-locked-border: var(--color-disabled-border);
    --color-dot-unlocked-bg: var(--color-accent-red);
    --color-dot-unlocked-border: #800000;
    --color-dot-beaten-bg: var(--color-accent-green);
    --color-dot-beaten-border: #2e5c30;
    --color-dot-hover-glow: var(--color-gold-light);

    /* --- Consolidated Effects Palette --- */

    /* Fire/Red Effects */
    --bg-red-weak: rgba(220, 20, 20, 0.2);
    --border-red: rgba(255, 40, 40, 0.9);

    --bg-fire-weak: rgba(255, 80, 0, 0.25);
    /* Previews, weak targets */
    --bg-fire-strong: rgba(255, 60, 0, 0.5);
    /* Strong targets */
    --border-fire: rgba(255, 80, 0, 0.8);

    /* Ice/Blue Effects */
    --bg-ice-weak: rgba(100, 200, 255, 0.25);
    --border-ice: rgba(0, 180, 255, 0.9);
    --shadow-ice: rgba(150, 220, 255, 0.7);

    /* Nature/Heal Effects */
    --bg-heal-weak: rgba(80, 220, 80, 0.2);
    --border-green: rgba(0, 255, 0, 0.8);
    --border-heal: var(--border-green);

    /* UI Overlays/Transparencies */
    --bg-gold-weak: rgba(184, 134, 11, 0.15);
    --bg-gold-strong: rgba(184, 134, 11, 0.25);
    --border-gold-weak: rgba(184, 134, 11, 0.3);
    --bg-dark-red-weak: rgba(139, 0, 0, 0.2);
    --border-dark-red: rgba(139, 0, 0, 0.4);

    /* Mappings to specific uses (simplifying) */
    --frost-nova-hover-bg: var(--bg-ice-weak);
    --frost-nova-hover-border: var(--border-ice);

    --attack-target-bg: var(--bg-red-weak);
    --attack-target-border: var(--border-red);
    --primary-target-bg: var(--bg-red-weak);
    --primary-target-border: var(--border-red);
    --primary-target-shadow: var(--bg-red-weak);
    /* Keep unique shadow? */

    --fireball-target-bg: var(--bg-fire-weak);
    --fireball-target-border: var(--border-fire);

    --flame-wave-preview-bg: var(--bg-fire-weak);
    --flame-wave-preview-border: var(--border-fire);
    --flame-wave-target-bg: var(--bg-fire-strong);
    --flame-wave-target-border: var(--border-fire);

    --cleave-target-bg: var(--bg-fire-weak);
    --cleave-target-border: var(--border-fire);

    --heal-target-bg: var(--bg-heal-weak);
    --heal-target-glow: var(--border-heal);

    --valid-move-bg: rgba(0, 0, 0, 0.3);
    --valid-move-border: rgba(80, 80, 80, 0.7);
    --selected-filter-outline: drop-shadow(1px 0 0 var(--color-gold-light)) drop-shadow(-1px 0 0 var(--color-gold-light)) drop-shadow(0 1px 0 var(--color-gold-light)) drop-shadow(0 -1px 0 var(--color-gold-light));
    --selected-player-filter-outline: drop-shadow(1px 0 0 var(--color-gold-light)) drop-shadow(-1px 0 0 var(--color-gold-light)) drop-shadow(0 1px 0 var(--color-gold-light)) drop-shadow(0 -1px 0 var(--color-gold-light));
    --selected-enemy-filter-outline: drop-shadow(1px 0 0 var(--color-red-bright)) drop-shadow(-1px 0 0 var(--color-red-bright)) drop-shadow(0 1px 0 var(--color-red-bright)) drop-shadow(0 -1px 0 var(--color-red-bright));
    --hover-outline-color-player: var(--color-gold-light);
    --hover-outline-color-enemy: var(--color-red-bright);
    --hover-player-filter-outline: drop-shadow(1px 0 0 var(--hover-outline-color-player)) drop-shadow(-1px 0 0 var(--hover-outline-color-player)) drop-shadow(0 1px 0 var(--hover-outline-color-player)) drop-shadow(0 -1px 0 var(--hover-outline-color-player));
    --hover-enemy-filter-outline: drop-shadow(1px 0 0 var(--hover-outline-color-enemy)) drop-shadow(-1px 0 0 var(--hover-outline-color-enemy)) drop-shadow(0 1px 0 var(--hover-outline-color-enemy)) drop-shadow(0 -1px 0 var(--hover-outline-color-enemy));
    --spell-locked-filter: grayscale(80%) brightness(0.6) saturate(3) hue-rotate(350deg) contrast(0.9);
    --spell-used-filter: grayscale(90%) brightness(60%);
    --elite-filter: hue-rotate(45deg);
    --stealth-filter: opacity(0.5);
    --frozen-filter: sepia(1) hue-rotate(200deg) saturate(15) brightness(1) contrast(1) drop-shadow(0 0 2px var(--color-cyan-bright)) drop-shadow(0 0 5px var(--color-cyan-glow));
    --acted-filter: grayscale(100%) brightness(0.6);
    --slowed-filter: sepia(0.8) hue-rotate(20deg) brightness(0.9);

    /* Official classes with glow */
    .goblin-red {
        filter: sepia(1) saturate(5) hue-rotate(-50deg) drop-shadow(0 0 2px var(--color-red-bright)) drop-shadow(0 0 5px var(--color-red-bright));
    }

    .goblin-gold {
        filter: sepia(1) saturate(3) hue-rotate(5deg) brightness(1.2) drop-shadow(0 0 2px var(--color-gold-light)) drop-shadow(0 0 5px var(--color-gold-light));
    }

    .goblin-purple {
        filter: hue-rotate(240deg) saturate(1.5) drop-shadow(0 0 2px #d000ff) drop-shadow(0 0 5px #d000ff);
    }

    .goblin-dark {
        filter: brightness(0.5) contrast(1.2) drop-shadow(0 0 2px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 5px rgba(0, 0, 0, 0.8));
    }

    /* New Shaman Variants (No Glow, Darker Colors) */
    .goblin-blood-caller {
        filter: sepia(1) saturate(6) hue-rotate(-50deg) brightness(0.8) contrast(1.2);
    }

    .goblin-witchdoctor {
        filter: hue-rotate(240deg) saturate(2) brightness(0.7) contrast(1.3);
    }

    .goblin-bloodOrange {
        filter: sepia(1) saturate(5) hue-rotate(-20deg) drop-shadow(0 0 2px var(--color-orange-highlight)) drop-shadow(0 0 5px var(--color-red-bright));
    }

    --shadow-weak: drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.5));
    --shadow-strong: drop-shadow(3px 3px 5px rgba(0, 0, 0, 0.8));

    --unit-base-shadow: var(--shadow-weak);
    --unit-hover-shadow: drop-shadow(2px 3px 4px rgba(0, 0, 0, 0.6));
    /* Keep mid? or strong? */
    --item-base-shadow: var(--shadow-strong);
    /* was 0.7 */
    --item-hover-shadow: var(--shadow-strong);
    --obstacle-base-shadow: var(--shadow-strong);
    /* was 0.6 */
    --projectile-base-shadow: var(--shadow-strong);
    /* was 0.6 */
    --fireball-projectile-shadow: drop-shadow(3px 3px 8px var(--border-fire));
    --fireball-explode-shadow: drop-shadow(0 0 7px var(--bg-fire-strong));
    --flame-wave-explode-shadow: drop-shadow(0 0 5px var(--bg-fire-strong));
    --frost-nova-shadow: 0 0 20px var(--shadow-ice),
    inset 0 0 10px var(--bg-ice-weak);
    --popup-text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.7),
    4px 4px 7px rgba(0, 0, 0, 0.9);
    --tooltip-shadow: 4px 4px 15px rgba(0, 0, 0, 0.8);

    --tooltip-bg: var(--color-wood-dark);
    --tooltip-text: var(--color-text-main);
    --tooltip-border: var(--color-wood-light);

    --popup-damage-color: var(--color-red-bright);
    --popup-heal-color: var(--color-green-bright);
    --popup-gold-color: var(--color-gold-light);
    --popup-gem-color: var(--color-blue-light);
    --popup-freeze-color: var(--color-cyan-bright);

    --spritesheet-items: url('./sprites/items.png');
    --spritesheet-items-width: 80px;
    --spritesheet-items-height: 160px;
    --spritesheet-armor-icons: url('./sprites/armor.png');
    --spritesheet-armor-width: 200px;
    --spritesheet-armor-height: 40px;
    --spritesheet-humans-grey: url('./sprites/humans_grey.png');
    --spritesheet-unit-base-url: './sprites/';

    --icon-button-size: 44px;
    --level-dot-size: clamp(18px, 2.5vmin, 18px);
    --stack-offset-x: 3px;
    --stack-offset-y: -3px;
    --chest-size-factor: 0.7;
    --item-size-factor: 0.6;
    --gold-size-factor: 0.6;
    --gem-size-factor: 0.6;
    --potion-size-factor: 0.6;
    --magnet-size-factor: 0.6;
    --spellbook-size-factor: 0.6;
    --explosion-sprite-width: 960px;
    --explosion-sprite-height: 120px;
    --map-bg-url: url('./sprites/world_map.png');
    --spritesheet-skills: url('./sprites/skills.png');
    --spritesheet-icons: url('./sprites/icons.png');
    --spritesheet-icons-short: url('./sprites/icons_short.png');
}

@keyframes glow-unlocked {

    0%,
    100% {
        box-shadow: 0 0 7px 2px var(--color-dot-unlocked-bg), 0 0 2px 1px var(--color-gold-light) inset, 0 0 5px rgba(0, 0, 0, 0.6);
    }

    50% {
        box-shadow: 0 0 18px 5px var(--color-dot-unlocked-bg), 0 0 4px 2px var(--color-gold-light) inset, 0 0 12px rgba(0, 0, 0, 0.8);
    }
}

@keyframes pulse-beaten {

    0%,
    100% {
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 6px var(--color-dot-beaten-bg), 0 0 4px rgba(0, 0, 0, 0.5);
    }

    50% {
        transform: translate(-50%, -50%) scale(1.05);
        box-shadow: 0 0 10px var(--color-dot-beaten-bg), 0 0 7px rgba(0, 0, 0, 0.7);
    }
}

@keyframes explosion-anim {
    to {
        background-position: calc(-1 * var(--explosion-sprite-width)) 0;
    }
}

@keyframes frost-nova-expand {
    0% {
        transform: translate(-50%, -50%) scale(0.1);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(calc(1.1 + var(--frost-nova-level, 1) * 1.1));
        opacity: 0;
    }
}

@keyframes simple-hit-flash {
    50% {
        filter: brightness(1.8) var(--unit-base-shadow);
    }
}

@keyframes moveUpFadeOut {
    0% {
        opacity: 1;
        transform: translateY(0) translateX(-50%) scale(1);
    }

    100% {
        opacity: 0;
        transform: translateY(-45px) translateX(-50%) scale(0.8);
    }
}

@keyframes item-magnet-fly {
    0% {
        transform: translate(calc(-50% + var(--stackIndex, 0) * var(--stack-offset-x)), calc(-50% + var(--stackIndex, 0) * var(--stack-offset-y))) scale(1);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) scale(0.2) rotate(90deg);
        left: var(--target-x);
        top: var(--target-y);
        opacity: 0;
    }
}

@keyframes flame-wave-target {
    0% {
        background-color: var(--flame-wave-target-bg);
    }

    100% {
        background-color: transparent;
    }
}

/* frost-nova-warning styles moved to end of file with animation */

html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    box-sizing: border-box;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: var(--color-iron-black);
    font-family: 'Courier New', Courier, monospace;
    color: var(--color-text-main);
    padding: 0;
    position: relative;
}

*,
*::before,
*::after {
    box-sizing: inherit;
}

.visually-hidden {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    vertical-align: middle;
    image-rendering: pixelated;
    -ms-interpolation-mode: nearest-neighbor;
}

.hidden {
    display: none !important;
}

.invisible {
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
}

.stealth-invisible {
    opacity: 0 !important;
    transition: opacity 1s ease-in-out !important;
    pointer-events: none !important;
}

.stealth-fading-in {
    opacity: 1 !important;
    transition: opacity 1s ease-in-out !important;
}

#game-container {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    justify-content: center;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    padding: 0;
    gap: 0;
    background: linear-gradient(135deg, var(--color-iron-medium), var(--color-iron-black));
    box-shadow: 0 0 35px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 0, 0, 0.7);
    border-radius: 4px;
    position: relative;
}

#game-container:fullscreen {
    padding: 0;
    border: none;
    gap: 5px;
}

#game-board-wrapper {
    position: relative;
    flex-grow: 1;
    flex-shrink: 1;
    display: flex;
    align-items: stretch;
    justify-content: stretch;
    overflow: hidden;
    min-width: 160px;
    min-height: calc(160px / var(--board-aspect-ratio, 0.8));
    background-color: #383838;
    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.85);
    border-radius: 6px;
}

#game-board {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    cursor: grab;
    user-select: none;
    -webkit-user-drag: none;
}

#game-board.panning {
    cursor: grabbing;
}

#grid-content {
    position: absolute;
    top: 0;
    left: 0;
    display: grid;
    grid-template-columns: repeat(var(--grid-cols, 8), 1fr);
    grid-template-rows: repeat(var(--grid-rows, 10), 1fr);
    width: calc(var(--grid-cols, 8) * var(--cell-size));
    height: calc(var(--grid-rows, 10) * var(--cell-size));
    image-rendering: pixelated;
    transform-origin: top left;
    will-change: transform;
}

.grid-cell {
    background-image: var(--current-tileset-url, none);
    background-color: rgba(0, 0, 0, 0.45);
    background-size: cover;
    background-position: center;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.2s, box-shadow 0.2s;
    image-rendering: pixelated;
    min-width: 1px;
    min-height: 1px;
    overflow: hidden;
    width: var(--cell-size);
    height: var(--cell-size);
    /* Grid lines - prominent dark inset shadow for visibility */
    box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
}

.grid-cell.valid-move::before {
    content: '';
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background-color: var(--valid-move-bg);
    z-index: 5;
    pointer-events: none;
    transition: background-color 0.2s;
}

.grid-cell.valid-move {
    box-shadow: inset 0 0 0 1px var(--valid-move-border);
}

/* Slow movement (mud terrain) - brownish tint */
.grid-cell.valid-move-slow::before {
    content: '';
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(139, 90, 43, 0.35);
    z-index: 1;
}

.grid-cell.valid-fireball-target:not(.has-obstacle) {
    background-color: var(--fireball-target-bg);
    box-shadow: inset 0 0 0 2px var(--fireball-target-border);
    cursor: crosshair !important;
    z-index: 1;
}

.unit.valid-fireball-target {
    filter: var(--unit-base-shadow) drop-shadow(0 0 6px rgba(255, 80, 0, 0.9));
    transform: translate(-50%, -50%) scale(1.1);
    background-color: transparent;
    box-shadow: none;
}

.grid-cell.valid-heal-target:not(.has-obstacle) {
    background-color: var(--heal-target-bg);
    box-shadow: inset 0 0 0 2px var(--heal-target-glow);
    cursor: help !important;
    z-index: 1;
}

.unit.valid-heal-target {
    filter: var(--unit-base-shadow) drop-shadow(0 0 8px var(--heal-target-glow));
    transform: translate(-50%, -50%) scale(1.1);
    background-color: transparent;
    box-shadow: none;
}

.grid-cell.has-obstacle {
    cursor: not-allowed !important;
}


/* Allow valid-move on obstacles (like Towers) */
.obstacle.valid-move {
    z-index: 10;
}

.obstacle.valid-move::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--cell-size);
    height: var(--cell-size);
    box-shadow: inset 0 0 0 2px var(--color-accent-green);
    filter: drop-shadow(0 0 5px var(--color-accent-green));
    background-color: transparent;
    pointer-events: none;
}

/* Allow flame-wave-preview on obstacles */
.obstacle.flame-wave-preview-row {
    background-color: transparent;
    z-index: 10;
}

.obstacle.flame-wave-preview-row::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: var(--cell-size);
    height: var(--cell-size);
    box-shadow: 0 0 0 2px var(--flame-wave-preview-border);
    pointer-events: none;
}

/* Player Flame Wave spell targeting */
.grid-cell.flame-wave-preview-row:not(.has-obstacle) {
    background-color: var(--flame-wave-preview-bg);
    box-shadow: inset 0 0 0 2px var(--flame-wave-preview-border);
    z-index: 2;
}

/* Enemy Pyromancer Flame Wave warning (incoming attack) */
.grid-cell.flame-wave-warning:not(.has-obstacle) {
    background-color: var(--bg-fire-weak);
    box-shadow: inset 0 0 0 2px var(--bg-fire-strong);
    animation: flame-wave-pulse 1s ease-in-out infinite;
    z-index: 2;
}

@keyframes flame-wave-pulse {

    0%,
    100% {
        background-color: var(--bg-fire-weak);
        box-shadow: inset 0 0 0 2px var(--bg-fire-strong);
    }

    50% {
        background-color: var(--bg-fire-strong);
        box-shadow: inset 0 0 0 2px var(--border-fire);
    }
}

#game-board.fireball-targeting,
#game-board.flame-wave-targeting,
#game-board.frost-nova-targeting {
    cursor: crosshair;
}

#game-board.heal-targeting {
    cursor: help;
}

#board-feedback-area {
    position: absolute;
    top: 15%;
    left: 50%;
    transform: translateX(-50%);
    pointer-events: none;
    z-index: 2000;
    text-align: center;
    width: 90%;
    max-width: 600px;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 14px;
    background: linear-gradient(rgba(60, 60, 60, 0.94), rgba(35, 35, 35, 0.97));
    border-radius: 12px;
    padding: 12px 22px;
    border: 2px solid var(--color-iron-medium);
    border-top-color: var(--color-iron-highlight);
    border-left-color: var(--color-iron-highlight);
    box-shadow: 0 5px 18px rgba(0, 0, 0, 0.75), inset 0 1px 3px rgba(255, 255, 255, 0.07);
    /* CRITICAL: Allow text wrapping - this must be the ONLY white-space declaration */
    white-space: normal !important;
    word-wrap: break-word;
    /* FONT SIZE: Default for mobile */
    font-size: 1.6rem;
}

/* Desktop: Larger font and auto width */
@media (min-width: 1024px) {
    #board-feedback-area {
        width: auto !important;
        max-width: 80% !important;
        font-size: 2rem !important;
    }
}

#board-feedback-area.feedback-levelup,
#board-feedback-area.feedback-gold,
#board-feedback-area.feedback-spell-unlock,
#board-feedback-area.feedback-achievement-unlock {
    color: var(--color-gold-light);
    text-shadow: 1px 1px 0px var(--color-gold-dark), 4px 4px 7px rgba(0, 0, 0, 0.9);
    border-color: var(--color-gold-base);
    border-top-color: var(--color-gold-highlight);
    border-left-color: var(--color-gold-highlight);
}

#board-feedback-area.feedback-error {
    color: var(--color-error);
    text-shadow: 1px 1px 0px var(--color-accent-red), 4px 4px 7px rgba(0, 0, 0, 0.9);
    border-color: var(--color-accent-red);
    border-top-color: var(--color-red-bright);
    border-left-color: var(--color-red-bright);
}

#board-feedback-area.feedback-cheat {
    color: var(--color-cyan-bright);
    text-shadow: 1px 1px 0px var(--color-cyan-glow), 4px 4px 7px rgba(0, 0, 0, 0.9);
    border-color: var(--color-cyan-glow);
    border-top-color: var(--color-cyan-soft);
    border-left-color: var(--color-cyan-soft);
}

#board-feedback-area.feedback-turn {
    color: var(--color-blue-light);
    text-shadow: 1px 1px 0px var(--color-blue-base), 4px 4px 7px rgba(0, 0, 0, 0.9);
    border-color: var(--color-blue-base);
    border-top-color: var(--color-accent-blue);
    border-left-color: var(--color-accent-blue);
}

#board-feedback-area .icon-inline {
    height: 1em;
    width: 1em;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
    margin-left: 0.2em;
}

#default-view-button.icon-button {
    position: absolute;
    bottom: 15px;
    right: 15px;
    z-index: 50;
}

#fill-width-button.icon-button {
    position: absolute;
    bottom: 65px;
    right: 15px;
    z-index: 50;
}

.obstacle,
.projectile,
.effect {
    position: absolute;
    pointer-events: none;
    image-rendering: pixelated;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transform-origin: center center;
    will-change: transform, opacity, left, top;
}

.item {
    position: absolute;
    pointer-events: auto;
    image-rendering: pixelated;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transform-origin: center center;
    will-change: transform, opacity, left, top;
}

.special-item-glow {
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 8px rgba(255, 215, 0, 1)) drop-shadow(0 0 15px rgba(255, 215, 0, 0.6)) !important;
    animation: golden-glow 2s ease-in-out infinite !important;
}

@keyframes golden-glow {

    0%,
    100% {
        filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 8px rgba(255, 215, 0, 1)) drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
        transform: var(--base-transform) scale(1);
    }

    50% {
        filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.9)) drop-shadow(0 0 12px rgba(255, 215, 0, 1)) drop-shadow(0 0 25px rgba(255, 215, 0, 0.8));
        transform: var(--base-transform) scale(1.15);
    }
}

.golden-particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: radial-gradient(circle, var(--color-gold-light) 0%, var(--color-gold-base) 100%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 100;
    box-shadow: 0 0 10px var(--color-gold-base);
}

.cyan-particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: radial-gradient(circle, #00ffff 0%, #008888 100%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 100;
    box-shadow: 0 0 10px #00ffff;
}

@keyframes golden-particle-rise {
    0% {
        transform: translateY(0) scale(1) rotate(0deg);
        opacity: 1;
    }

    100% {
        transform: translateY(-40px) scale(0) rotate(180deg);
        opacity: 0;
    }
}

@keyframes cyan-particle-rise {
    0% {
        transform: translateY(0) scale(1) rotate(0deg);
        opacity: 1;
    }

    100% {
        transform: translateY(-40px) scale(0) rotate(-180deg);
        opacity: 0;
    }
}

.unit {
    position: absolute;
    z-index: 1000 !important;
    /* Force Units ABOVE everything (walls are likely z-index auto or lower) */
    pointer-events: auto;
    image-rendering: pixelated;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transform-origin: center center;
    transform: translateZ(10px);
    /* Move into 3D foreground to defeat stacking contexts */
    will-change: transform, opacity, left, top, filter;
    transition: left var(--move-anim-time) linear, top var(--move-anim-time) linear, opacity 1s ease-in-out, filter 0.3s ease;
}


/* Aggressive cleanup for dead units to ensure no filters (like red outlines) persist */
.unit.dead {
    filter: none !important;
    pointer-events: none !important;
}

#unit-hp-bars-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 2000 !important;
}

.unit-hp-bar-world {
    position: absolute;
    width: var(--cell-size);
    height: 6px;
    background-color: var(--color-iron-black);
    border: 1px solid var(--color-iron-black);
    /* Positioned via JS based on unit grid coordinates */
    left: calc(var(--unit-grid-x) * var(--cell-size));
    top: calc(var(--unit-grid-y) * var(--cell-size) - 8px);
    /* Position above unit */
    transform: translate(0, 0);
    /* No centering needed if left/top are correct for cell */
    z-index: 21;
    /* Above overlay container */
    display: block;
    pointer-events: none;
    /* Ensure individual bars don't block */
}

.unit-hp-bar-world-fill {
    height: 100%;
    background-color: var(--color-hp-high);
    width: 100%;
    transition: width 0.3s ease, background-color 0.3s ease;
    pointer-events: none;
    /* Ensure fill doesn't block */
}

.unit {
    width: calc(var(--cell-size) * 0.8);
    height: calc(var(--cell-size) * 0.8);
    left: calc((var(--unit-x, 1) - 0.5) * var(--cell-size));
    top: calc((var(--unit-y, 1) - 0.5) * var(--cell-size));
    transform: translate(-50%, -50%);
    z-index: 10;
    transition: filter 0.2s, box-shadow 0.2s, opacity 0.2s ease-out, background-image 0.1s ease-in, background-position 0.1s steps(1), background-size 0.1s steps(1), transform var(--move-anim-time) ease-out, left var(--move-anim-time) ease-out, top var(--move-anim-time) ease-out;
    filter: var(--unit-base-shadow);
    pointer-events: auto;
    background-repeat: no-repeat;
}

.unit:not(.dead):not(.fading-out):not(.selected):not(.is-moving):hover {
    z-index: 12;
    cursor: pointer !important;
    transform: translate(-50%, -50%) scale(1.15);
    filter: var(--unit-hover-shadow) brightness(1.05);
}

.unit.player:not(.dead):not(.fading-out):not(.selected):not(.is-moving):hover {
    filter: var(--hover-player-filter-outline) var(--unit-hover-shadow) brightness(1.05);
}

.unit.enemy:not(.dead):not(.fading-out):not(.selected):not(.is-moving):hover {
    filter: var(--hover-enemy-filter-outline) var(--unit-hover-shadow) brightness(1.05);
}

.unit.selected {
    z-index: 13;
    filter: var(--selected-filter-outline) var(--unit-base-shadow);
    transform: translate(-50%, -50%) scale(1.1);
}

.unit.selected:hover {
    filter: var(--hover-player-filter-outline) var(--selected-filter-outline) var(--unit-hover-shadow) brightness(1.05);
    transform: translate(-50%, -50%) scale(1.15);
}

.unit:not(.selected):not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit):not(.dead).acted {
    filter: var(--acted-filter) var(--unit-base-shadow);
}

.unit:not(.selected):not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit).slowed {
    filter: var(--slowed-filter) var(--unit-base-shadow);
}

.unit:not(.selected):not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit).elite:not(.acted):not(.slowed) {
    filter: var(--elite-filter) var(--unit-base-shadow);
}

.unit:not(.selected):not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit):not(.dead).elite.acted {
    filter: var(--elite-filter) var(--acted-filter) var(--unit-base-shadow);
}

.unit:not(.selected):not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit).elite.slowed {
    filter: var(--elite-filter) var(--slowed-filter) var(--unit-base-shadow);
}

.unit.selected.player:not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit):not(.dead).acted {
    filter: var(--acted-filter) var(--selected-player-filter-outline) var(--unit-base-shadow);
}

.unit.selected.enemy:not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit):not(.dead).acted {
    filter: var(--acted-filter) var(--selected-enemy-filter-outline) var(--unit-base-shadow);
}

.unit.selected.player:not(.is-moving):not(.frozen):not(.netted):not(.stealthed):not(.is-hit).slowed {
    filter: var(--slowed-filter) var(--selected-player-filter-outline) var(--unit-base-shadow);
}

/* Unit hover and status filters are now handled by updateUnitVisualState for proper layering */
.unit.netted::after {
    content: '';
    display: block;
    position: absolute;
    top: 60%;
    left: 50%;
    width: 100%;
    height: 60%;
    background-image: url('./sprites/projectiles.png');
    background-size: 300% 100%;
    background-repeat: no-repeat;
    background-position: 50% 0;
    transform: translateX(-50%);
}

.obstacle {
    width: var(--cell-size);
    height: var(--cell-size);
    left: calc((var(--obs-x, 1) - 0.5) * var(--cell-size));
    top: calc((var(--obs-y, 1) - 0.5) * var(--cell-size));
    transform: translate(-50%, -50%);
    z-index: 2;
    transition: opacity var(--obstacle-destroy-time) ease-out, transform var(--obstacle-destroy-time) ease-out;
    filter: var(--obstacle-base-shadow);
    opacity: 1;
    pointer-events: auto;
}

/* Specific Shadow Reduction for Cages */
/* Specific Shadow Reduction for Cages */
.obstacle.cage_archer,
.obstacle.cage_champion,
.obstacle.cage_rogue,
.obstacle.cage_wizard,
.obstacle[class*="cage_"] {
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.3)) !important;
    box-shadow: none !important;
    /* Ensure no box-shadow interferes */
    /* Lighter shadow than base */
}

/* Locked Shop Item Silhouette - ONLY targets unit sprites */
.shop-item-locked .shop-item-icon,
.shop-item.shop-item-locked .shop-item-icon,
.shop-item-locked .shop-icon-container .shop-item-icon {
    filter: brightness(0) contrast(100) saturate(0) !important;
    opacity: 1 !important;
    -webkit-filter: brightness(0) contrast(100) saturate(0) !important;
    /* ABSOLUTE BLACK silhouette - only the sprite */
}

/* Locked card fade - applies to entire card but sprite overrides above */
.shop-item.shop-item-locked {
    opacity: 0.6;
    filter: grayscale(80%) brightness(0.8);
}





.obstacle.rock {
    width: calc(var(--cell-size) * 0.8);
    height: calc(var(--cell-size) * 0.8);
    background-image: url('./sprites/doodads.png');
    background-size: 400% 500%;
    background-position: 0% 0%;
}

.obstacle.wall_rock {
    background-image: url('./sprites/doodads.png');
    background-size: 400% 500%;
    background-position: 0% 100%;
}

.obstacle.tower {
    background-image: url('./sprites/doodads.png');
    background-size: 400% 500%;
    background-position: 0% 25%;
    z-index: 3;
    cursor: pointer;
}

.obstacle.door {
    background-image: url('./sprites/doodads.png');
    background-size: 400% 500%;
    background-position: 66.67% 75%;
    z-index: 4;
    cursor: crosshair;
}

.obstacle.door.vertical {
    transform: translate(-50%, -50%) rotate(90deg);
}

.obstacle.door.horizontal {
    transform: translate(-50%, -50%) rotate(0deg);
}

.obstacle.snowman {
    background-image: url('./sprites/enemy_obj.png');
    background-size: 300% 200%;
    background-position: 0% 100%;
    width: calc(var(--cell-size) * 0.9);
    height: calc(var(--cell-size) * 0.9);
}

/* Fix double border for snowmen: The valid-attack-target class is applied to BOTH
   the .grid-cell AND the .obstacle element. We need to remove the border from the obstacle
   so only the cell's border shows. */
.obstacle.snowman.valid-attack-target,
.obstacle.snowman.can-be-primary-target {
    box-shadow: none !important;
    filter: none !important;
    /* Also remove the drop-shadow to prevent any double effect */
}

.obstacle.destroyed {
    opacity: 0 !important;
    pointer-events: none !important;
    filter: none;
    transform: translate(-50%, -50%) scale(0.7) rotate(20deg);
    cursor: default !important;
}

.item {
    width: calc(var(--cell-size) * var(--item-size-factor, 0.6));
    height: calc(var(--cell-size) * var(--item-size-factor, 0.6));
    left: calc((var(--item-grid-x, 0) + 0.5) * var(--cell-size));
    top: calc((var(--item-grid-y, 0) + 0.5) * var(--cell-size));
    --base-transform: translate(calc(-50% + var(--stackIndex, 0) * var(--stack-offset-x)), calc(-50% + var(--stackIndex, 0) * var(--stack-offset-y)));
    transform: var(--base-transform);
    z-index: 9;
    transition: opacity var(--item-pickup-anim-time) ease-out, transform 0.3s cubic-bezier(0.45, 0.05, 0.55, 0.95);
    pointer-events: auto;
    cursor: pointer;
    filter: var(--item-base-shadow);
    opacity: 1;
    background-image: var(--spritesheet-items);
    background-size: 200% 400%;
    background-repeat: no-repeat;
    transform-origin: center center;
    will-change: transform, opacity, left, top;
}

.item.icon-gold,
.item.opened {
    pointer-events: none !important;
}

.item:hover {
    transform: var(--base-transform) scale(1.3) rotate(8deg);
    filter: var(--item-hover-shadow) brightness(1.2);
    z-index: 10;
}

.item.chest {
    width: calc(var(--cell-size) * var(--chest-size-factor, 0.7));
    background-image: url('./sprites/fireball_explode.png');
    background-position: 0 0;
    background-size: var(--explosion-sprite-width) var(--explosion-sprite-height);
    z-index: 24;
    transform: translate(-50%, -50%);
    animation: explosion-anim var(--fireball-explode-time) steps(8) forwards;
    animation-delay: var(--stagger-delay, 0ms);
    filter: brightness(1.15) contrast(1.15) var(--flame-wave-explode-shadow);
}

.frost-nova-effect {
    width: calc(var(--cell-size) * 2);
    height: calc(var(--cell-size) * 2);
    border-radius: 50%;
    background: radial-gradient(circle, rgba(200, 230, 255, 0.6) 0%, rgba(150, 220, 255, 0.3) 60%, rgba(100, 150, 255, 0.0) 100%);
    border: 4px solid rgba(220, 240, 255, 0.8);
    transform: translate(-50%, -50%) scale(0.1);
    opacity: 0;
    animation: frost-nova-expand var(--frost-nova-expand-time) ease-out forwards;
    z-index: 20;
    box-shadow: var(--frost-nova-shadow);
}

.popup {
    position: absolute;
    font-weight: bold;
    animation: moveUpFadeOut var(--popup-duration) forwards;
    z-index: 50;
    pointer-events: none;
    transform: translateX(-50%);
    white-space: nowrap;
    text-shadow: var(--popup-text-shadow);
    font-size: clamp(1.5rem, 2.7vmin, 2.1rem);
}

.damage-popup {
    color: var(--popup-damage-color);
}

.freeze-popup {
    color: var(--popup-freeze-color);
    animation-duration: 0.9s;
}

.heal-popup {
    color: var(--popup-heal-color);
}

.gold-popup,
.gem-popup {
    display: flex;
    align-items: center;
    gap: 4px;
}

.gold-popup {
    color: var(--popup-gold-color);
}

.gem-popup {
    color: var(--popup-gem-color);
}

.gold-popup img,
.gem-popup img {
    height: 1em;
    width: 1em;
    margin: 0;
}

#unit-hp-bars-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 80;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    transform-origin: top left;
    will-change: transform, opacity;
}

#unit-hp-bars-overlay.visible {
    opacity: 1;
}

.unit-hp-bar-world {
    position: absolute;
    width: calc(var(--cell-size) * 0.7);
    height: 5px;
    background-color: var(--hp-bar-bg);
    border: 1px solid var(--hp-bar-border);
    border-radius: 2px;
    overflow: hidden;
    z-index: 16;
    pointer-events: none;
    left: calc((var(--unit-grid-x, 0) + 0.5) * var(--cell-size));
    top: calc((var(--unit-grid-y, 0) + 0.5) * var(--cell-size));
    transform: translateX(-50%) translateY(calc(var(--cell-size) * -0.6));
    will-change: transform, left, top;
}

.unit-hp-bar-world-fill {
    height: 100%;
    background-color: var(--hp-high);
    width: 0%;
    border-radius: 1px;
    transition: width 0.2s ease, background-color 0.2s ease;
    pointer-events: none;
}

.unit-hp-bar-world-fill.hp-low {
    background-color: var(--hp-low);
}

.unit-hp-bar-world-fill.hp-mid {
    background-color: var(--hp-mid);
}

.unit-hp-bar-world-fill.hp-high {
    background-color: var(--hp-high);
}

#ui-panel {
    width: var(--ui-panel-width);
    flex-shrink: 0;
    max-height: 100%;
    background: linear-gradient(to bottom right, var(--color-wood-base), var(--color-wood-darkest));
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
}

.panel-content-wrapper {
    padding: 0 clamp(0.5rem, 1vmin, 0.8rem) !important;
    padding-bottom: clamp(0.8rem, 1.2vmin, 1.2rem);
    display: flex;
    flex-direction: column;
    gap: clamp(0.5rem, 1vmin, 0.8rem);
    flex-grow: 1;
    min-height: 0;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--color-wood-light) var(--color-wood-darkest);
}

.panel-content-wrapper::-webkit-scrollbar {
    width: 10px;
}

.panel-content-wrapper::-webkit-scrollbar-track {
    background: linear-gradient(var(--color-wood-darkest), var(--color-wood-dark));
}

.panel-content-wrapper::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--color-wood-light), var(--color-wood-base));
    border-radius: 5px;
    border: 1px solid var(--color-wood-darkest);
}

#side-panel-navigation {
    width: 100%;
    margin-top: 0 !important;
    margin-bottom: 2px !important;
    flex-shrink: 0;
}

.nav-top-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0 6px 2px 6px !important;
    box-sizing: border-box;
    gap: 6px;
}

.view-controls-bar {
    position: absolute;
    bottom: 10px;
    right: 10px;
    display: flex;
    gap: 10px;
    align-items: center;
    z-index: 100;
}

.side-panel-gold {
    /* Manual sizing as requested: Small but readable */
    font-size: clamp(0.85rem, 1.6vmin, 1.2rem) !important;
    padding: 0.3rem 0.5rem !important;
    height: auto;

    font-weight: bold;
    background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
    border-radius: 5px;
    white-space: nowrap;
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.7);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9);

    /* Layout - stretch to fill */
    flex: 1 1 0;
    min-width: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--color-gold-light);
    margin: 0;
    box-sizing: border-box;
}

.side-panel-gold .icon-menu {
    width: 18px !important;
    height: 18px !important;
    min-width: 18px !important;
    margin-right: 5px;
    flex-shrink: 0;
    background-image: var(--spritesheet-items) !important;
    background-size: 400% 500% !important;
    background-position: 0% 25% !important;
    /* Col 0, Row 1 - Gold */
    image-rendering: pixelated;
}

#level-display {
    font-weight: bold;
    background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
    padding: 0.4rem 0.6rem;
    border-radius: 5px;
    font-size: clamp(0.9rem, 1.8vmin, 1.4rem);
    white-space: nowrap;
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.7);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9);
    text-align: center;
    flex: 1 1 0;
    min-width: 0;
}

#level-display {
    color: var(--color-gold-light);
}



#menu-button.icon-button {
    align-self: center;
    flex-shrink: 0;
    padding: 2px !important;
}

#menu-button.no-backdrop {
    padding: 2px !important;
}

#unit-info {
    background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.55));
    padding: 1.2rem;
    border-radius: 8px;
    box-shadow: inset 0 2px 7px rgba(0, 0, 0, 0.75);
    width: 100%;
    flex-shrink: 0;
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 15px;
    align-items: start;
}

.unit-visuals {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

#unit-portrait {
    width: 90px;
    height: 90px;
    border: 3px solid var(--color-iron-dark);
    border-top-color: var(--color-iron-medium);
    border-left-color: var(--color-iron-medium);
    background: linear-gradient(135deg, var(--color-disabled-bg), var(--color-disabled-border));
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
    flex-shrink: 0;
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.2s, background-image 0.2s, background-position 0.1s steps(1), background-size 0.1s steps(1), filter 0.2s;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.7);
}

#unit-portrait[style*="background-image"] {
    opacity: 1;
}

.unit-visuals>.unit-hp-bar-container.info-panel-hp-bar {
    width: 100%;
    height: 18px;
    margin: 0;
}

#unit-details {
    display: flex;
    flex-direction: column;
    min-width: 0;
    font-size: 1.3rem;
}

#unit-name {
    margin: 0 0 0.8rem 0;
    color: var(--color-text-header);
    font-size: 1.7rem;
    font-weight: bold;
    text-shadow: 1px 1px 1px var(--color-gold-dark), 2px 2px 5px rgba(0, 0, 0, 0.9);
    word-wrap: break-word;
}

#unit-info p {
    margin: 0.4rem 0;
    color: var(--color-text-muted);
    line-height: 1.5;
    word-wrap: break-word;
}

#unit-status {
    min-height: 1.6em;
    color: var(--color-iron-highlight);
    font-style: italic;
    font-weight: bold;
    margin-top: auto;
}

#unit-abilities {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 10px 0 5px 0;
    justify-content: flex-start;
    flex-shrink: 0;
}

/* Make ability buttons same size as spell icons */
#unit-abilities .spell-icon {
    width: clamp(40px, 7vmin, 50px);
    height: clamp(40px, 7vmin, 50px);
    padding: 0;
    border: 2px solid var(--color-iron-black);
    border-radius: 4px;
    background-color: var(--color-iron-medium);
    /* Let the icon classes control background-size and background-position */
    box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.5), 0 2px 4px rgba(0, 0, 0, 0.4);
}

.ability-button {
    padding: 6px 12px;
    font-size: 1.2rem;
    font-weight: bold;
    border: 2px solid var(--color-iron-black);
    border-top-color: var(--color-iron-medium);
    border-left-color: var(--color-iron-medium);
    border-radius: 4px;
    background: linear-gradient(to bottom, var(--color-iron-medium), var(--color-iron-dark));
    color: var(--color-text-main);
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1), inset 0 -1px 1px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: all 0.15s ease-out;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
    min-width: 80px;
    text-align: center;
}

.ability-button:hover:not(:disabled) {
    filter: brightness(1.15);
    transform: translateY(-2px);
    box-shadow: 0 5px 8px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.15), inset 0 -1px 1px rgba(0, 0, 0, 0.2);
}

.ability-button:active:not(:disabled) {
    filter: brightness(0.9);
    transform: translateY(1px);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
}

.ability-button:disabled {
    background: linear-gradient(var(--color-disabled-bg), #555);
    color: var(--color-disabled-text);
    border-color: var(--color-disabled-border);
    cursor: not-allowed;
    opacity: 0.6;
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.5);
    text-shadow: none;
    transform: none;
}

.unit-hp-bar-container {
    width: 100%;
    background-color: var(--hp-bar-bg);
    border: 1px solid var(--hp-bar-border);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.7);
    z-index: 10;
}

.unit-hp-bar {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background-color: var(--hp-high);
    transition: width 0.3s ease, background-color 0.3s ease;
    border-radius: 3px 0 0 3px;
    background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.25), rgba(0, 0, 0, 0.25));
    width: var(--hp-percent, 100%);
}

.unit-hp-bar-container[style*="--hp-percent: 100%"] .unit-hp-bar {
    border-radius: inherit;
}

.unit-hp-bar[data-hp-level="low"] {
    background-color: var(--hp-low);
}

.unit-hp-bar[data-hp-level="mid"] {
    background-color: var(--hp-mid);
}

.unit-hp-bar[data-hp-level="high"] {
    background-color: var(--hp-high);
}

.unit-hp-bar[data-hp-level="empty"] {
    background: none !important;
    width: 0 !important;
}

.unit-hp-text {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.8), 2px 2px 3px rgba(0, 0, 0, 0.9);
    line-height: 1;
    z-index: 1;
    pointer-events: none;
    font-size: 1.1rem;
}

.unit-hp-bar-container.info-panel-hp-bar {
    height: 18px;
    margin: 8px 0 12px 0;
}

.unit-hp-bar-container.tooltip-hp-bar {
    height: 11px;
    margin-top: 5px;
    border-radius: 3px;
    box-shadow: none;
    z-index: 100;
}

.unit-hp-bar-container.tooltip-hp-bar .unit-hp-text {
    font-size: 0.9rem;
    text-shadow: 1px 1px 1px black;
}

.panel-bottom-group {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: clamp(1.1rem, 1.7vmin, 1.8rem);
    width: 100%;
    flex-shrink: 0;
}

#spell-area {
    background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.55));
    padding: 1.2rem;
    border-radius: 8px;
    box-shadow: inset 0 2px 7px rgba(0, 0, 0, 0.75);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
    gap: clamp(10px, 1.8vmin, 15px);
    place-items: center;
    width: 100%;
    flex-shrink: 0;
}

.spell-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    width: auto;
}

.spell-icon,
.skill-icon {
    position: relative;
    display: inline-block;
    width: clamp(40px, 7vmin, 50px);
    height: clamp(40px, 7vmin, 50px);
    border: 2px solid var(--color-iron-black);
    border-radius: 4px;
    background-color: var(--color-iron-medium);
    background-size: 85%;
    background-repeat: no-repeat;
    background-position: center;
    margin-bottom: 3px;
    transition: border-color 0.2s, box-shadow 0.2s, filter 0.2s;
    image-rendering: pixelated;
    vertical-align: middle;
    filter: none;
    cursor: default;
    box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.5), 0 2px 4px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    appearance: none;
    padding: 0;
}

.spell-label {
    font-size: clamp(0.9rem, 1.5vmin, 1.1rem);
    font-weight: bold;
    color: var(--color-text-main) !important;
    text-shadow: 1px 1px var(--color-iron-dark);
    line-height: 1.2;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.skill-icon-sprite {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
    pointer-events: none;
    z-index: 1;
}

.spell-icon .hotkey-display {
    position: absolute;
    top: 0px;
    left: 0px;
    font-size: clamp(0.8rem, 1.3vmin, 1rem);
    font-weight: bold;
    color: var(--color-gold-highlight);
    background-color: rgba(0, 0, 0, 0.7);
    padding: 1px 4px;
    line-height: 1;
    border-radius: 0 0 4px 0;
    text-shadow: 1px 1px var(--color-gold-dark);
}

.spell-icon.locked {
    filter: var(--spell-locked-filter);
    cursor: not-allowed;
    border-color: var(--color-red-dark);
    box-shadow: inset 0 0 4px rgba(100, 0, 0, 0.7), 0 2px 4px rgba(0, 0, 0, 0.4);
}

.spell-icon.locked+.spell-label {
    color: var(--color-text-muted);
    filter: brightness(0.8);
}

.spell-icon.used {
    filter: var(--spell-used-filter);
    cursor: not-allowed;
    border-color: var(--color-iron-dark);
    box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.7), 0 2px 4px rgba(0, 0, 0, 0.4);
}

.spell-icon.used+.spell-label {
    color: var(--color-disabled-text);
}

.spell-icon.available {
    filter: none;
    cursor: pointer;
    border-color: var(--color-iron-highlight);
}

.spell-icon.available:hover {
    border-color: var(--color-gold-light);
    box-shadow: 0 0 6px var(--color-gold-light), inset 0 0 4px rgba(0, 0, 0, 0.5), 0 2px 4px rgba(0, 0, 0, 0.4);
}

.spell-icon.available+.spell-label {
    color: var(--color-text-main);
}

.gold-text {
    color: var(--color-gold-light);
    font-weight: bold;
}

.spell-icon.cheat-available {
    border-color: lime !important;
    box-shadow: 0 0 8px lime !important;
}

.spell-icon.cheat-available+.spell-label {
    color: lime;
}

.spell-icon.selected {
    filter: none !important;
    cursor: pointer;
    border-color: var(--color-gold-light) !important;
    box-shadow: 0 0 10px var(--color-gold-light) !important;
}

.spell-icon.selected+.spell-label {
    color: var(--color-gold-light);
}

/* Spell Icons - Consolidated Spritesheet Definitions */
.icon-spell-fireball {
    background-image: url('./sprites/projectiles.png') !important;
    background-size: 300% 100% !important;
    background-position: 100% 0%;
    background-repeat: no-repeat;
}

.icon-spell-flameWave,
.icon-spell-frostNova,
.icon-spell-heal,
.icon-spell-arcaneJolt,
.icon-spell-polymorph,
.icon-ability-quickStrike,
.icon-skill-tacticalcommand,
.icon-skill-loothoarder,
.icon-skill-evasion,
.icon-skill-thorns,
.icon-skill-vampiricaura {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-repeat: no-repeat;
}

.icon-spell-flameWave {
    background-position: 0% 0%;
}

.icon-spell-frostNova {
    background-position: 25% 0%;
}

.icon-spell-heal {
    background-position: 50% 0%;
}

.icon-spell-arcaneJolt {
    background-position: 75% 0%;
}

.icon-spell-polymorph {
    background-position: 100% 0% !important;
    background-repeat: no-repeat !important;
}

.icon-ability-quickStrike {
    background-position: 0% 50%;
}

.icon-skill-tacticalcommand {
    background-position: 25% 50%;
}

.icon-skill-loothoarder {
    background-position: 50% 50%;
}

.icon-skill-evasion {
    background-position: 75% 50%;
}

.icon-skill-thorns {
    background-position: 100% 50%;
}

.icon-skill-vampiricaura {
    background-position: 0% 100%;
}

.end-turn-style {
    font-size: 1.9rem;
    gap: 0;
    background: linear-gradient(to bottom, var(--color-orange-highlight), var(--color-orange-base));
    color: var(--color-orange-text);
    border-color: var(--color-orange-dark);
    text-shadow: 1px 1px 2px var(--color-orange-shadow);
    font-family: inherit;
    font-weight: bold;
    border-width: 2px;
    border-style: solid;
    border-top-color: var(--color-orange-highlight);
    border-left-color: var(--color-orange-highlight);
    border-radius: 6px;
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.15), inset 0 -2px 2px rgba(0, 0, 0, 0.35);
    cursor: pointer;
    transition: all 0.15s ease-out;
    padding: clamp(12px, 2.4vmin, 18px) clamp(25px, 6vmin, 40px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    text-decoration: none;
    margin: 0.4rem 0;
    min-width: 150px;
    width: 100%;
    flex-shrink: 0;
}

.end-turn-style:hover:not(:disabled) {
    background: linear-gradient(to bottom, var(--color-orange-highlight), var(--color-orange-base));
    filter: brightness(1.15);
    border-color: var(--color-orange-shadow);
    border-top-color: var(--color-orange-highlight);
    border-left-color: var(--color-orange-highlight);
    box-shadow: 0 8px 14px rgba(0, 0, 0, 0.6), inset 0 1px 1px rgba(255, 255, 255, 0.2), inset 0 -2px 2px rgba(0, 0, 0, 0.4);
    transform: translateY(-3px);
}

.end-turn-style:active:not(:disabled) {
    background: linear-gradient(to top, var(--color-orange-highlight), var(--color-orange-base));
    filter: brightness(0.9);
    border-color: var(--color-orange-shadow);
    box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.7);
    transform: translateY(1px);
}

.end-turn-style:disabled,
.end-turn-style.disabled {
    background: linear-gradient(var(--color-disabled-text), var(--color-iron-medium));
    color: var(--color-disabled-text);
    border-color: var(--color-disabled-border);
    cursor: not-allowed;
    opacity: 0.6;
    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.5);
    text-shadow: none;
    filter: grayscale(70%);
    transform: none;
}

.hotkey-text,
.hotkey-e {
    color: var(--color-gold-light) !important;
    font-weight: bold !important;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8) !important;
    display: inline !important;
    padding: 0 !important;
    margin: 0 !important;
    background: none !important;
}

.end-turn-style.next-level-mode {
    background: linear-gradient(to bottom, var(--color-success), var(--color-accent-green));
    border-color: var(--color-green-dark);
    color: var(--color-text-main);
}

.end-turn-style.next-level-mode:active:not(:disabled) {
    background: linear-gradient(to top, var(--color-success), var(--color-accent-green));
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(20, 20, 20, 0.96);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: var(--color-text-main);
    text-align: center;
    z-index: 100;
    padding: 20px;
    box-sizing: border-box;
}

.overlay.visible {
    display: flex;
}

.styled-overlay-content {
    background: linear-gradient(to bottom right, var(--color-wood-base), var(--color-wood-darkest));
    border-radius: 8px;
    padding: 0;
    width: 95%;
    max-width: clamp(380px, 90%, 850px);
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 0;
    max-height: 95vh;
    overflow: hidden;
    position: relative;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.85), inset 0 0 25px rgba(0, 0, 0, 0.6);
}

.no-border,
#shop-screen .styled-overlay-content {
    border: none !important;
    background: linear-gradient(rgba(46, 30, 23, 0.95), rgba(30, 20, 15, 0.98)) !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.9) !important;
}

#shop-screen .decorative-frame {
    display: none !important;
}

.overlay-scroll-container {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    padding: clamp(0.5rem, 2vmin, 1.2rem);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: clamp(0.4rem, 1vmin, 0.8rem);

    scrollbar-width: thin;
    scrollbar-color: var(--color-wood-light) var(--color-wood-darkest);
}

.overlay-scroll-container::-webkit-scrollbar {
    width: 10px;
}

.overlay-scroll-container::-webkit-scrollbar-track {
    background: linear-gradient(var(--color-wood-darkest), #2a1f15);
}

.overlay-scroll-container::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--color-wood-light), var(--color-wood-base));
    border-radius: 5px;
    border: 1px solid var(--color-wood-darkest);
}

.level-select-content.no-style {
    background: none;
    border: none;
    box-shadow: none;
    padding: 0;
    border-radius: 0;
    max-width: 100%;
    max-height: 100%;
    width: 100%;
    height: 100%;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 0;
    color: var(--color-text-main);
}

.decorative-frame {
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: inherit;
    pointer-events: none;
    z-index: 1;
}

.overlay-title {
    color: var(--color-text-header);
    font-size: clamp(2.5rem, 7vmin, 3.5rem);
    font-weight: bold;
    text-shadow: 1px 1px 0px var(--color-gold-dark), 3px 3px 5px var(--color-text-shadow);
    margin: -0.5rem 0 1rem 0;
    padding: 0.6rem 2.2rem;
    border: 1px solid var(--color-iron-medium);
    border-radius: 4px;
    background: linear-gradient(var(--color-iron-dark), var(--color-iron-black));
    box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.05), 0 2px 4px rgba(0, 0, 0, 0.6);
    position: relative;
    z-index: 2;
    display: inline-block;
}

.overlay-title.defeat-title {
    color: var(--color-error);
    text-shadow: 1px 1px 0px var(--color-accent-red), 3px 3px 5px var(--color-text-shadow);
    background: linear-gradient(var(--color-red-dark), var(--color-red-base));
    border-color: var(--color-accent-red);
}

.overlay-title.shop-title {
    color: var(--color-gold-light);
    text-shadow: 1px 1px 0px var(--color-gold-dark), 3px 3px 5px var(--color-text-shadow);
    background: linear-gradient(var(--color-gold-base), var(--color-gold-dark));
    border-color: var(--color-gold-dark);
}

.styled-overlay-content p {
    font-size: clamp(1.4rem, 4vmin, 1.7rem);
    line-height: 1.7;
    margin-bottom: 1.3rem;
    color: var(--color-text-main);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

.styled-overlay-content strong,
.styled-overlay-content span:not([class*="icon"]):not(.hotkey-display):not(.volume-value):not([class*="-level"]):not([class*="-count"]):not([class*="-cost"]):not(#level-select-page-info):not(#achievement-completion-status) {
    filter: brightness(1.1);
    color: var(--color-gold-light);
}

.gold-display {
    color: var(--color-gold-light);
    text-shadow: 1px 1px 0px var(--color-gold-dark), 2px 2px 5px rgba(0, 0, 0, 0.8);
    font-size: clamp(2rem, 2vmin, 2rem);
    font-weight: bold;
    text-align: center;
    background: linear-gradient(to bottom, var(--color-iron-medium), var(--color-iron-dark));
    padding: 0.4rem 1.5rem;
    border: 2px solid var(--color-gold-base);
    border-radius: 6px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: default;
    box-shadow: inset 0 0 9px rgba(0, 0, 0, 0.7), 0 4px 8px rgba(0, 0, 0, 0.6), 0 0 0 2px var(--color-iron-dark);
    position: relative;
    gap: 8px;
}

.menu-like-gold-display {
    cursor: default;
}

.inset-panel {
    background-color: rgba(0, 0, 0, 0.35);
    padding: 1.4rem;
    border-radius: 8px;
    box-shadow: inset 0 2px 12px rgba(0, 0, 0, 0.7);
    width: 100%;
    box-sizing: border-box;
}

button,
.primary-button,
.secondary-button,
.icon-button {
    font-family: inherit;
    font-weight: bold;
    border: 2px solid var(--color-iron-black);
    border-top-color: var(--color-iron-medium);
    border-left-color: var(--color-iron-medium);
    border-radius: 6px;
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.1), inset 0 -2px 2px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.15s ease-out;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    text-decoration: none;
    margin: 0.4rem 0;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
    appearance: none;
}

button:hover:not(:disabled),
.primary-button:hover:not(:disabled),
.secondary-button:hover:not(:disabled),
.icon-button:hover:not(:disabled) {
    color: var(--color-gold-light);
    filter: brightness(1.15);
    box-shadow: 0 8px 14px rgba(0, 0, 0, 0.6), inset 0 1px 1px rgba(255, 255, 255, 0.15), inset 0 -2px 2px rgba(0, 0, 0, 0.3);
    transform: translateY(-3px);
}

button:active:not(:disabled),
.primary-button:active:not(:disabled),
.secondary-button:active:not(:disabled),
.icon-button:active:not(:disabled) {
    filter: brightness(0.9);
    box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.7);
    transform: translateY(1px);
}

button:disabled,
.primary-button:disabled,

.primary-button,
.secondary-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    text-align: center;
    min-width: 150px;
    padding: clamp(5px, 1.2vmin, 8px) clamp(25px, 6vmin, 40px);
    transition: transform 0.2s, filter 0.2s, box-shadow 0.2s;
    border-radius: 6px;
    border: 2px solid var(--color-iron-black);
    border-top-color: var(--color-iron-medium);
    border-left-color: var(--color-iron-medium);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.1), inset 0 -2px 2px rgba(0, 0, 0, 0.3);
    font-weight: 700;
    cursor: pointer;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    font-size: clamp(1.4rem, 3.5vmin, 1.6rem);
    line-height: normal;
}

.primary-button {
    background: linear-gradient(to bottom, var(--color-wood-base), var(--color-wood-dark));
    color: var(--color-text-main);
}

.secondary-button {
    background: linear-gradient(to bottom, var(--color-iron-medium), var(--color-iron-dark));
    color: var(--color-text-muted);
}

.secondary-button:hover:not(:disabled) {
    color: var(--color-gold-light);
}

.secondary-button:active:not(:disabled) {
    background: linear-gradient(to top, var(--color-iron-medium), var(--color-iron-dark));
}

.primary-button.green-accent,
.secondary-button.green-accent {
    background: linear-gradient(to bottom, var(--color-success), var(--color-accent-green));
    border-color: #2e5c30;
    color: #fff;
}

.primary-button.green-accent:hover:not(:disabled),
.secondary-button.green-accent:hover:not(:disabled) {
    color: var(--color-gold-light) !important;
}

.primary-button.green-accent:active:not(:disabled),
.secondary-button.green-accent:active:not(:disabled) {
    background: linear-gradient(to top, var(--color-success), var(--color-accent-green));
}

.primary-button.gold-accent,
.secondary-button.gold-accent {
    background: linear-gradient(to bottom, var(--color-gold-light), var(--color-gold-base));
    border-color: var(--color-gold-dark);
    color: #403010;
    text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.4);
}

.primary-button.gold-accent:active:not(:disabled),
.secondary-button.gold-accent:active:not(:disabled) {
    background: linear-gradient(to top, var(--color-gold-light), var(--color-gold-base));
}

.icon-button {
    background: radial-gradient(circle at 50% 40%, var(--color-iron-highlight) 0%, var(--color-iron-medium) 70%, var(--color-iron-dark) 100%);
    color: var(--color-text-main);
    font-size: calc(var(--icon-button-size, 44px) * 0.5);
    padding: 0;
    width: var(--icon-button-size, 44px);
    height: var(--icon-button-size, 44px);
    line-height: 1;
    flex-shrink: 0;
    margin: 0;
}

/* Global Disabled Button Styles */
button:disabled,
.primary-button:disabled,
.secondary-button:disabled,
.primary-button.disabled-style,
.secondary-button.disabled-style,
.icon-button:disabled,
.icon-button.disabled-style {
    background: linear-gradient(to bottom, #444, #222) !important;
    border-color: var(--color-disabled-border) !important;
    color: var(--color-disabled-text) !important;
    filter: grayscale(1) brightness(0.8) !important;
    cursor: not-allowed !important;
    box-shadow: none !important;
    transform: none !important;
    text-shadow: none !important;
    pointer-events: auto !important;
    /* Allow tooltips */
}

.icon-button:hover:not(:disabled) {
    border-color: var(--color-iron-highlight);
    filter: brightness(1.2);
    transform: scale(1.12);
    box-shadow: 0 5px 9px rgba(0, 0, 0, 0.7), inset 0 1px 1px rgba(255, 255, 255, 0.15);
}

.icon-button:active:not(:disabled) {
    filter: brightness(0.85);
    transform: scale(1.05);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.8);
}

.icon-button span {
    display: inline-block;
}

.button-group {
    display: flex;
    justify-content: space-around;
    width: 100%;
    gap: 1.4rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.button-group .primary-button,
.button-group .secondary-button {
    margin: 0;
    flex-grow: 1;
    min-width: 170px;
}

.icon {
    display: inline-block;
    vertical-align: middle;
    background-repeat: no-repeat;
    image-rendering: pixelated;
    width: 1em;
    height: 1em;
    background-size: contain;
}

.icon-inline {
    width: 1.1em;
    height: 1.1em;
    vertical-align: -0.15em;
    margin-left: 0.3em;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
}

.icon.gold-icon-inline {
    width: 1em;
    height: 1em;
    vertical-align: middle;
}

/* Fix inline gold icon sizing */
.icon.icon-inline.icon-gold {
    background-size: 400% 500%;
}

.icon-menu {
    width: 1.5em;
    height: 1.5em;
    filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.7));
}

.icon-shop {
    width: 100%;
    height: 100%;
}

.bonus-icon {
    width: clamp(64px, 12vmin, 120px) !important;
    height: clamp(64px, 12vmin, 120px) !important;
    filter: drop-shadow(2px 2px 4px var(--color-gold-dark));
}

.icon {
    background-image: var(--spritesheet-items);
    background-size: 400% 500% !important;
    /* 4 columns x 5 rows */
    background-repeat: no-repeat;
    background-position: 0% 25%;
    /* Gold is at col 0, row 1 */
}

.shop-item-icon.icon-armor {
    background-image: var(--spritesheet-armor-icons);
    background-size: 500% 100% !important;
    background-repeat: no-repeat;
    display: inline-block;
    width: 100%;
    height: 100%;
}

.icon-armor-none {
    background-position: 0% 0%;
    filter: grayscale(1) brightness(0.8);
}

.icon-armor-grey {
    background-position: 0% 0%;
}

.icon-armor-green {
    background-position: 25% 0%;
}

.icon-armor-red {
    background-position: 50% 0%;
}

.icon-armor-yellow {
    background-position: 75% 0%;
}

.icon-armor-blue {
    background-position: 100% 0%;
}

/* Shop Unit Icons - Consolidated Master Block */
.shop-icon-container .shop-item-icon.icon-unit-knight,
.shop-icon-container .shop-item-icon.icon-unit-archer,
.shop-icon-container .shop-item-icon.icon-unit-rogue,
.shop-icon-container .shop-item-icon.icon-unit-champion,
.shop-icon-container .shop-item-icon.icon-unit-wizard {
    background-image: var(--spritesheet-humans-grey);
    background-size: 300% 500% !important;
    /* 3 cols x 5 rows */
    background-repeat: no-repeat;
}

/* Specific Positions */
.shop-icon-container .shop-item-icon.icon-unit-knight {
    background-position: 0% 0% !important;
}

.shop-icon-container .shop-item-icon.icon-unit-archer {
    background-position: 0% 25% !important;
}

.shop-icon-container .shop-item-icon.icon-unit-champion {
    background-position: 0% 50% !important;
}

.shop-icon-container .shop-item-icon.icon-unit-rogue {
    background-position: 0% 75% !important;
}

.shop-icon-container .shop-item-icon.icon-unit-wizard {
    background-position: 0% 100% !important;
}

/* Individual icon unit rules removed - consolidated into master block above */

/* Consolidated bonus icon rules removed - using master block at line ~5240 */

.icon-tacticalcommand {
    background-image: url('./sprites/icon_troop_increase.png');
}

.achievement-icon[style*="achievement_locked"] {
    background-image: url('./sprites/achievement_locked.png');
}

/* Icon unit rules removed - using spritesheet-based rules at line ~3463 instead */

.icon-chest-closed {
    background-image: url('./sprites/items.png');
    background-position: 0% 0%;
    background-size: 200% 400% !important;
    background-repeat: no-repeat;
}

.icon-chest-opened {
    background-image: url('./sprites/items.png');
    background-position: 100% 0%;
    background-size: 200% 400% !important;
    background-repeat: no-repeat;
}

/* Legacy icon duplicates removed */

#main-menu .main-menu-background {
    background-image: url('./images/titlescreen.jpg');
    background-size: cover;
    background-position: center center;
    background-color: var(--color-iron-black);
    border: none;
    box-shadow: none;
    padding: clamp(1rem, 3vh, 2rem) clamp(1rem, 5vw, 3rem);
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    border-radius: 0;
    overflow: hidden;
}

#main-menu-title-image {
    max-width: clamp(350px, 60vw, 700px);
    height: auto;
    margin-top: clamp(1rem, 5vh, 2rem);
    margin-bottom: clamp(1.5rem, 5vh, 3rem);
    filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.8));
    position: relative;
    z-index: 2;
}

.main-menu-buttons {
    display: flex;
    flex-direction: column;
    gap: clamp(1rem, 2vmin, 1.5rem);
    min-width: clamp(250px, 45%, 380px);
    position: relative;
    z-index: 2;
}

.main-menu-buttons .primary-button {
    width: 100%;
    padding: clamp(14px, 2.8vmin, 20px) 25px;
    font-size: clamp(1.8rem, 4.5vmin, 2.2rem);
}

.main-menu-buttons .primary-button:hover {
    color: var(--color-gold-light);
}

#level-complete-screen .styled-overlay-content {
    max-width: 1000px;
}

#level-complete-stats {
    text-align: left;
    width: 100%;
    margin-bottom: 0.2rem;
    padding: clamp(0.6rem, 2vmin, 1.2rem);
}

.stats-row {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 0.2rem;
}

.stats-row p {
    margin: 0.2rem 0 !important;
    flex: 1;
}

.level-complete-footer {
    display: flex;
    align-items: stretch;
    justify-content: space-between;
    gap: 15px;
    width: 100%;
    margin-top: clamp(8px, 2vmin, 15px);
    padding-top: clamp(8px, 2vmin, 15px);
}

.total-gold-footer {
    display: none;
    /* Replaced by level-complete-gold-box */
}

#next-level-button {
    background: linear-gradient(180deg, #24cd24 0%, #049f28 50%, #016501 100%) !important;
    border-color: #33cf33 #1a331a #1a331a #6ab06a !important;
    color: white !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8) !important;
}

#next-level-button:hover {
    background: linear-gradient(180deg, #5aa55a 0%, #3d6d3d 50%, #2d4a2d 100%) !important;
    transform: scale(1.02);
}

/* .hotkey-text moved to unified section at line 1595 */

.level-complete-gold-box {
    flex: 0.8;
    margin: 0 !important;
    padding: 0 12px !important;
    font-size: clamp(1.2rem, 3vmin, 1.5rem) !important;
    height: clamp(40px, 6vmin, 50px) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 100px !important;
    box-shadow: inset 0 0 9px rgba(0, 0, 0, 0.7), 0 4px 8px rgba(0, 0, 0, 0.6) !important;
}

.level-complete-buttons {
    flex: 2.5;
    /* Significantly wider than gold box */
    gap: 12px !important;
    margin: 0 !important;
}

.level-complete-buttons button {
    flex: 1 !important;
    height: clamp(40px, 6vmin, 50px) !important;
    padding: 0 15px !important;
    font-size: clamp(1.4rem, 3.5vmin, 1.6rem) !important;
    white-space: nowrap;
}

#level-complete-stats p {
    margin: clamp(0.4rem, 1.5vmin, 0.8rem) 0;
    font-size: clamp(1.3rem, 3.5vmin, 1.6rem);
    color: var(--color-text-main);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    gap: 5px;
}

#level-complete-bonuses {
    margin: clamp(0.8rem, 2vmin, 1.4rem) 0;
    border-top: 2px solid var(--color-iron-medium);
    padding-top: clamp(0.8rem, 2vmin, 1.4rem);
}

#level-complete-bonuses p {
    font-weight: bold;
    margin-bottom: 0.6rem;
    color: var(--color-text-main);
    font-size: clamp(1.4rem, 3.5vmin, 1.7rem);
    text-align: left;
}

#level-complete-bonuses ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 1rem;
}

#level-complete-bonuses li {
    color: var(--color-text-muted);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

#level-complete-bonuses .bonus-amount {
    color: var(--color-gold-light);
    font-weight: bold;
}

#game-over-screen .styled-overlay-content {
    max-width: 600px;
}

#game-over-message {
    font-size: 1.6rem;
    color: var(--color-text-main);
    margin-bottom: 2rem;
    font-weight: bold;
}

#level-select-screen {
    background-color: rgba(10, 12, 15, 0.96);
}

#level-select-map-container {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #1c222a;
    /* Fallback if map image missing */
    cursor: grab;
    z-index: 0;
    /* Behind everything */
}

#level-select-map-container.panning {
    cursor: grabbing;
}

#level-select-map {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: var(--map-bg-url);
    background-size: contain;
    background-position: center center;
    background-repeat: no-repeat;
    transform-origin: top left;
    will-change: transform;
    image-rendering: pixelated;
    border: none;
    padding: 0;
}

#level-select-dots-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    transform-origin: top left;
    will-change: transform;
    border: none;
    padding: 0;
    overflow: hidden;
}

.level-dot-tooltip {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.85);
    color: #fff;
    padding: 8px 12px;
    border-radius: 7px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8), 0 0 10px rgba(0, 0, 0, 0.5);
    line-height: 1.4;
    transition: opacity 0.15s ease-in-out;
    pointer-events: none;
    /* Prevents tooltip from capturing mouse events and causing flickering */
}

.level-dot {
    position: absolute;
    width: var(--level-dot-size);
    height: var(--level-dot-size);
    border-radius: 50%;
    border: 2px solid var(--color-iron-black);
    box-shadow: 0 0 8px 3px rgba(0, 0, 0, 0.65), inset 0 0 5px rgba(0, 0, 0, 0.6);
    cursor: pointer;
    transition: all 0.2s ease-out;
    pointer-events: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: calc(var(--level-dot-size) * 0.45);
    font-weight: bold;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9);
    will-change: transform;
    transform: translate(-50%, -50%);
    --shine: radial-gradient(circle at 45% 38%, rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0) 55%);
    background: var(--shine), linear-gradient(var(--color-iron-medium), var(--color-iron-dark));
}

.level-dot.locked {
    background: var(--shine), linear-gradient(var(--color-dot-locked-bg), var(--color-iron-dark));
    border-color: var(--color-dot-locked-border);
    cursor: not-allowed;
    opacity: 0.5;
    filter: grayscale(80%);
    box-shadow: inset 0 0 7px rgba(0, 0, 0, 0.8);
    animation: none;
}

.level-dot.unlocked {
    background: var(--shine), linear-gradient(var(--color-dot-unlocked-bg), var(--color-accent-red));
    border-color: var(--color-dot-unlocked-border);
    animation: glow-unlocked 1.8s infinite ease-in-out;
    color: #fff;
}

.level-dot.beaten {
    background: var(--shine), linear-gradient(var(--color-dot-beaten-bg), var(--color-accent-green));
    border-color: var(--color-dot-beaten-border);
    animation: pulse-beaten 3s infinite ease-in-out;
    color: #e8f5e9;
}

.level-dot:not(.locked):hover {
    transform: translate(-50%, -50%) scale(1.45);
    border-color: var(--color-gold-light);
    box-shadow: 0 0 14px 4px var(--color-gold-light), inset 0 0 6px rgba(0, 0, 0, 0.6);
    z-index: 1;
    filter: brightness(1.1);
}

#level-select-pagination {

    .pagination-button {
        background: var(--color-iron-medium);
        border: 1px solid var(--color-iron-dark);
        color: var(--color-text-main);
        padding: 5px 0;
        width: 44px;
        text-align: center;
        border-radius: 3px;
        cursor: pointer;
        transition: color 0.2s;
        box-sizing: border-box;
        flex-shrink: 0;
    }

    .pagination-button:hover:not(:disabled) {
        color: var(--color-gold-light);
    }

    .pagination-button:disabled {
        background: var(--color-disabled-bg);
        color: var(--color-disabled-text);
        cursor: not-allowed;
    }

    #level-select-page-info {
        font-weight: bold;
    }

    .bottom-bar-style {
        display: flex;
        gap: 25px;
        justify-content: center;
        align-items: center;
        width: 100%;
        padding: 4px 30px;
        box-sizing: border-box;
        background: linear-gradient(rgba(20, 20, 25, 0.85), rgba(10, 10, 12, 0.98));
        flex-shrink: 0;
        border-top: 2px solid var(--color-iron-medium);
        box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.65);
        z-index: 10;
    }

    .bottom-bar-style .secondary-button,
    .bottom-bar-style .primary-button {
        margin: 0;
        padding: 0 15px;
        /* No vertical padding, height handles it */
        min-width: 120px;
        height: 38px;
        /* Standardized uniform height */
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .level-select-bottom-bar #level-select-shop-button {
        order: -1;
    }
}

#leaderboard-overlay .styled-overlay-content {
    max-width: 850px;
}

#leaderboard-list {
    list-style: none;
    padding: 20px;
    max-height: 50vh;
    overflow-y: auto;
    width: 100%;
    margin-bottom: 1.5rem;
    /* Connect to header */
    border-radius: 0 0 6px 6px;
    /* Remove top radius */
    background: linear-gradient(rgba(40, 40, 40, 0.7), rgba(30, 30, 30, 0.8));
    margin-top: 0;
    /* Ensure no gap */
    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.7);
}

#leaderboard-list li {
    background-color: rgba(255, 255, 255, 0.06);
    padding: 10px 15px;
    margin-bottom: 8px;
    border-radius: 4px;
    display: grid;
    grid-template-columns: 0.5fr 0.7fr 2fr 0.8fr 2fr 2fr;
    gap: 15px;
    align-items: center;
    font-size: clamp(1.3rem, 3.4vmin, 1.6rem);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: background-color 0.2s, box-shadow 0.2s;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    text-align: center;
}

#leaderboard-list li span:first-child {
    text-align: left;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.7);
}

#leaderboard-list li span:nth-child(2),
#leaderboard-list li span:nth-child(3),
#leaderboard-list li span:nth-child(4) {
    text-align: left;
    color: #ffffff;
    font-weight: normal;
}

/* Local profiles show as Gold */
#leaderboard-list li.local-profile-row span {
    color: var(--color-gold-light) !important;
    font-weight: bold;
}

#leaderboard-list li.highlight-player {
    background: var(--bg-gold-weak);
    border-color: var(--border-gold-weak);
    /* assuming 0.4 matched or close enough to 0.3 */
    box-shadow: inset 0 0 10px var(--bg-gold-weak);
    /* 0.1 vs 0.15 close enough */
}

#leaderboard-list li span:last-child {
    color: var(--color-text-muted);
    font-size: 0.9em;
    text-align: right;
}

.leaderboard-table-wrapper {
    display: flex;
    flex-direction: column;
    width: 100%;
    margin-bottom: 1.5rem;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
}

.leaderboard-table-wrapper #leaderboard-list {
    margin-bottom: 0;
}

.leaderboard-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 0;
    width: 100%;
    justify-content: flex-start;
}

.leaderboard-tab-button {
    padding: 8px 20px;
    background: linear-gradient(to bottom, #4a4a4a, #2a2a2a);
    border: 1px solid #555;
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    color: #aaa;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: bold;
    transition: all 0.2s;
    font-family: inherit;
}

.leaderboard-tab-button:hover {
    background: linear-gradient(to bottom, #5a5a5a, #3a3a3a);
    color: var(--color-gold-light);
}

.shop-tab-button.locked {
    filter: grayscale(1) !important;
    opacity: 0.6 !important;
    cursor: not-allowed !important;
    border-color: #444 !important;
    color: #888 !important;
}

.shop-tab-button.locked:hover {
    color: #888 !important;
    transform: none !important;
}

.leaderboard-tab-button.active {
    background: linear-gradient(to bottom, var(--color-gold-base), var(--color-gold-dark));
    color: white;
    border-color: var(--color-gold-light);
    box-shadow: 0 -2px 10px rgba(255, 215, 0, 0.2);
    z-index: 2;
}

.leaderboard-header {
    display: grid;
    grid-template-columns: 0.5fr 0.7fr 2fr 0.8fr 2fr 2fr;
    gap: 15px;
    margin: 0;
    /* Remove margin to match list width */
    /* Match #leaderboard-list padding (20px) + li padding (15px) = 35px */
    padding: 12px 35px;
    background: linear-gradient(to bottom, var(--color-iron-medium), var(--color-iron-dark));
    border: 2px solid var(--color-gold-base);
    border-bottom: none;
    /* Visual flow into list */
    /* Nice border of their own */
    border-radius: 4px 4px 0 0;
    /* Remove bottom radius */
    font-weight: bold;
    color: var(--color-gold-light);
    font-size: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
    white-space: nowrap;
    /* Prevent wrapping */
}

.leaderboard-header span:first-child,
.leaderboard-header span:nth-child(2) {
    text-align: left;
}

.leaderboard-header span:last-child {
    text-align: right;
}

.leaderboard-input {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    margin-bottom: 1rem;
}

.name-input-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    width: 100%;
    margin-top: 1.5rem;
}

.name-input-panel label {
    display: none;
    /* Keep name prompt clean, placeholder is enough */
}

.name-input-panel input[type="text"] {
    width: 80%;
    text-align: center;
    font-size: 1.8rem;
    padding: 12px;
}

.name-input-panel button {
    width: 60%;
    margin-top: 10px;
}

.leaderboard-input label {
    flex-shrink: 0;
}

.leaderboard-input input[type="text"] {
    flex-grow: 1;
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid var(--color-iron-medium);
    background-color: rgba(0, 0, 0, 0.3);
    color: var(--color-text-main);
}

.leaderboard-input button {
    margin: 0;
    flex-shrink: 0;
    padding: 8px 16px;
}

#menu-overlay .styled-overlay-content {
    max-width: clamp(360px, 70%, 620px);
}

#menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: clamp(1.1rem, 3.2vmin, 1.6rem);
    width: clamp(240px, 80%, 350px);
    align-items: center;
    margin-top: 1rem;
}

#menu-buttons-container .primary-button,
#menu-buttons-container .secondary-button {
    width: 100%;
}

#menu-overlay #close-menu-button {
    margin-top: 2rem;
    width: fit-content;
    align-self: center;
}

#settings-overlay .styled-overlay-content {
    max-width: clamp(400px, 90%, 600px);
}

#settings-overlay .settings-container {
    margin-top: 1.5rem;
}

.settings-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    text-align: left;
}

.setting-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.setting-item label:not(.setting-toggle) {
    font-weight: bold;
    color: var(--color-text-main);
}

.setting-item input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    background: transparent;
    cursor: pointer;
    margin: 0;
    padding: 0;
    height: 24px;
}

/* Chrome, Safari, Edge, Opera */
.setting-item input[type="range"]::-webkit-slider-runnable-track {
    width: 100%;
    height: 8px;
    background: linear-gradient(to right, var(--color-orange-highlight) 0%, var(--color-orange-highlight) var(--fill-percent, 0%), rgba(0, 0, 0, 0.6) var(--fill-percent, 0%), rgba(0, 0, 0, 0.6) 100%);
    border-radius: 4px;
    border: 1px solid var(--color-gold-dark);
}

.setting-item input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 20px;
    width: 20px;
    background: var(--color-gold-light);
    border-radius: 50%;
    margin-top: -7px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--color-gold-base);
    position: relative;
    z-index: 2;
}

/* Firefox */
.setting-item input[type="range"]::-moz-range-track {
    width: 100%;
    height: 8px;
    background: linear-gradient(to right, var(--color-orange-highlight) 0%, var(--color-orange-highlight) var(--fill-percent, 0%), rgba(0, 0, 0, 0.6) var(--fill-percent, 0%), rgba(0, 0, 0, 0.6) 100%);
    border-radius: 4px;
    border: 1px solid var(--color-gold-dark);
}

.setting-item input[type="range"]::-moz-range-thumb {
    height: 20px;
    width: 20px;
    background: var(--color-gold-light);
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--color-gold-base);
}

#menu-overlay #close-menu-button,
#settings-overlay #close-settings-button {
    margin-top: 10px;
    padding: 5px;
}

.setting-item .volume-value {
    font-size: 1.1rem;
    color: var(--color-gold-light);
    text-align: right;
    margin-bottom: -5px;
}

.setting-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 1.4rem;
    transition: color 0.2s;
}

.setting-toggle:hover {
    color: var(--color-gold-light);
}

.setting-item.half-width {
    width: 48%;
}

.menu-settings-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    justify-items: center;
    margin-bottom: 20px;
}

/* Sprite Frame Overrides for Menu Buttons */
#menu-mute-button,
#menu-fullscreen-button,
#restart-level-setting-button,
#mute-setting-button,
#fullscreen-setting-button {
    width: 70px !important;
    height: 70px !important;
    padding: 0 !important;
    border: none !important;
    background-color: transparent !important;
    background-image: var(--spritesheet-icons) !important;
    background-position: 75% 25% !important;
    /* Row 1, Col 3 */
    background-size: 500% 500% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    box-shadow: none !important;
}

.settings-icon.icon-icons {
    width: 48px !important;
    height: 48px !important;
    font-size: 2rem !important;
    transition: transform 0.2s, filter 0.2s;
}

.settings-icon.icon-icons:hover {
    transform: scale(1.1);
    filter: brightness(1.2);
}

/* Custom Toggle Switch */
.toggle-switch-container {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    user-select: none;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.4);
    transition: .4s;
    border-radius: 24px;
    border: 1px solid var(--color-gold-dark);
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 3px;
    background-color: var(--color-gold-light);
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

input:checked+.toggle-slider {
    background-color: rgba(205, 103, 15, 0.4);
    border-color: var(--color-orange-highlight);
}

input:checked+.toggle-slider:before {
    transform: translateX(24px);
    background-color: var(--color-orange-highlight);
}

.toggle-label {
    color: var(--color-gold-light);
    font-weight: bold;
    font-size: 1.1rem;
    text-shadow: 1px 1px 2px black;
}

@media (max-width: 480px) {
    .settings-icon.icon-icons {
        width: 40px !important;
        height: 40px !important;
    }

    .menu-settings-grid {
        gap: 10px;
    }
}


.setting-item input[type="text"] {
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid var(--color-iron-medium);
    background-color: rgba(0, 0, 0, 0.3);
    color: var(--color-text-main);
    font-family: inherit;
    font-size: 1.4rem;
}

#restart-level-setting-button span {
    display: flex;
    align-items: center;
    gap: 8px;
}

#achievements-overlay {
    background: linear-gradient(rgba(20, 20, 20, 0.85), rgba(20, 20, 20, 0.85)),
        url('./images/titlescreen.jpg') !important;
    background-size: cover !important;
    background-position: center center !important;
    background-color: var(--color-iron-black) !important;
}

#achievements-overlay .styled-overlay-content {
    width: 98% !important;
    max-width: 98vw !important;
    height: 95vh !important;
    max-height: 95vh !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
}

#achievements-list {
    list-style: none;
    padding: 10px;
    flex: 1 1 auto;
    overflow-y: auto;
    width: 100%;
    margin-bottom: 0.5rem;
    border-radius: 6px;
    background: linear-gradient(rgba(40, 40, 40, 0.7), rgba(30, 30, 30, 0.8));
    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.7);
}

/* Consolidated Achievement Styles */
.achievement-item {
    background-color: rgba(255, 255, 255, 0.06);
    padding: 8px;
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.2s, background-color 0.2s;
    text-align: center;
    min-height: 90px;
    justify-content: flex-start;
    cursor: help;
}

.achievement-item:hover {
    transform: translateY(-2px);
    background-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}

.achievement-item.unlocked {
    background: linear-gradient(to bottom, rgba(255, 215, 0, 0.1), rgba(50, 40, 10, 0.3));
    border-color: var(--color-gold-base);
}

.achievement-item.locked {
    opacity: 0.7;
    filter: grayscale(0.8);
}

.achievement-icon {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.5));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.achievement-item.unlocked .achievement-icon {
    border-color: var(--color-gold-dark);
    filter: drop-shadow(2px 2px 4px var(--color-gold-dark));
}

.achievement-details {
    width: 100%;
    margin-top: 4px;
}

.achievement-title {
    font-weight: bold;
    font-size: 0.95rem;
    margin: 0;
    color: var(--color-text-main);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    /* Standard property */
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.achievement-item.unlocked .achievement-title {
    color: var(--color-gold-highlight);
}

.achievement-progress {
    margin-top: 4px;
    font-size: 0.85rem;
    color: var(--color-text-muted);
    font-weight: bold;
}

.achievement-item.unlocked .achievement-progress {
    color: var(--color-success);
}

.achievement-reward {
    margin-left: auto;
}

.achievement-reward.pending {
    opacity: 0.6;
}

#achievement-completion-status {
    font-weight: bold;
    color: var(--color-text-muted);
    margin-top: 1rem;
}

/* Achievement Section Grouping - Small tab appearance, block for vertical stacking */
.achievement-section-header {
    display: block;
    width: fit-content;
    padding: 2px 10px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 4px;
    margin: 10px 0 4px 0;
    font-size: 0.85rem;
    color: var(--color-gold-light);
    font-weight: bold;
    clear: both;
}

.achievement-section-header .section-progress {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    margin-left: 6px;
}

.achievement-section-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 6px;
    margin-bottom: 4px;
}

#shop-screen .shop-content {
    width: 98% !important;
    max-width: 98vw !important;
    height: 95vh !important;
    max-height: 95vh !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
}

#shop-screen .overlay-scroll-container {
    padding: 0.5rem 1rem !important;
    flex: 1 1 auto !important;
    min-height: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 0.5rem !important;
}

#shop-items-container {
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(10em, 1fr)) !important;
    gap: 6px !important;
    width: 100% !important;
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    padding: 10px !important;
    background: linear-gradient(rgba(46, 30, 23, 0.9), rgba(30, 20, 15, 0.94));
    border-radius: 8px;
    scrollbar-width: thin;
    scrollbar-color: var(--color-wood-light) var(--color-wood-darkest);
    align-content: start !important;
}

#shop-troops-button {
    white-space: nowrap !important;
    width: auto !important;
    min-width: 0 !important;
    padding: 0 20px !important;
    height: auto !important;
    min-height: 44px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 1.4rem !important;
    flex: 0 0 auto !important;
    /* Prevent flexing */
}

.item-uncommon {
    color: var(--color-success) !important;
}

/* Conflicting shop-bottom-bar rule removed to allow transparency */

.shop-bottom-bar button {
    margin: 0 !important;
    width: auto !important;
    min-width: 0 !important;
    flex: 0 0 auto !important;
}

#shop-items-container::-webkit-scrollbar-track {
    background: linear-gradient(var(--color-wood-darkest), #2a1f15);
}

#shop-items-container::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--color-wood-light), var(--color-wood-base));
    border-radius: 5px;
    border: 1px solid var(--color-wood-darkest);
}

.shop-section-header {
    grid-column: 1 / -1;
    color: var(--color-gold-light);
    text-align: left;
    font-size: 1.4rem;
    margin: 18px 0 10px 0;
    padding-bottom: 10px;
    padding-left: 10px;
    border-bottom: 1px solid rgba(255, 215, 0, 0.2);
    /* Restored separating line */
    text-shadow: 1px 1px 3px #3b2e1e;
}

#shop-recruit-header {
    margin-top: 0;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid rgba(212, 175, 55, 0.3);
    color: var(--color-gold-light);
    text-align: center;
    text-shadow: 1px 1px 2px black;
}

/* Desktop Drop Shadows for Level Complete Buttons - Softer than original, but prominent */
.level-complete-buttons .dropshadow {
    filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.8)) !important;
}

.shop-item {
    background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.45));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    margin-bottom: 0;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.2s ease-out;
    cursor: default;
    position: relative;
    box-shadow: 0 3px 7px rgba(0, 0, 0, 0.65);
    padding: 0.8rem;
    box-sizing: border-box;
}

/* Troops Tab Roster Management */
#shop-troops-tab-content {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}

.roster-management-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
    height: 100%;
    width: 100% !important;
}


.roster-section h3.shop-section-header {
    margin: 5px 0 8px 0;
    padding: 4px 0 4px 10px;
    font-size: 1.4rem;
    color: var(--color-gold-light);
    border-bottom: 2px solid rgba(184, 134, 11, 0.25);
}


.troops-list-container.drag-over {
    background: rgba(255, 187, 0, 0.08);
    border-color: rgba(255, 187, 0, 0.3);
}

.troop-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: transform 0.2s ease;
    width: 110px !important;
    height: auto !important;
    flex-shrink: 0;
    flex-grow: 0;
    margin-bottom: 2px;
    text-align: center;
    border: none !important;
    padding: 0 !important;
}

.troop-card:hover {
    transform: scale(1.05);
}

.troop-card .troop-card-visual {
    width: 110px !important;
    height: 110px !important;
    border: none !important;
    border-radius: 0;
    box-shadow: none !important;
    outline: none !important;

    background-image: var(--spritesheet-icons);
    background-position: 75% 25%;
    /* Row 1, Col 3 */
    background-size: 500% 500%;

    display: flex;
    justify-content: center;
    align-items: center;
}

#shop-screen .troop-card .troop-card-visual>div,
.troop-card .troop-card-visual>div {
    transform: scale(1.4);
    transform-origin: center;
}

.troop-card .troop-count {
    font-size: 2.2rem;
    font-weight: bold;
    color: var(--color-gold-light);
}

.troop-card.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(0.8);
}

.roster-unit-card.dragging {
    opacity: 0.5;
    cursor: grabbing;
}

.shop-item.selectable {
    cursor: pointer;
}

.shop-item.selectable:hover:not(.locked):not(.maxed):not(.selected):not(.active-armor) {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 9px 18px rgba(0, 0, 0, 0.75);
    background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.5));
    border-color: rgba(255, 255, 255, 0.15);
}

.shop-item.selectable:hover:not(.locked):not(.maxed):not(.selected):not(.active-armor) h4 {
    color: var(--color-gold-light);
}

.shop-item.selected {
    background: var(--shop-item-selected-bg);
    border-color: var(--shop-item-selected-border);
    box-shadow: 0 0 10px var(--shop-item-selected-border), inset 0 0 5px rgba(255, 215, 0, 0.2);
    transform: scale(1.02);
}

.shop-icon-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 5em;
    height: 5em;
    margin-bottom: 8px;
    background-color: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--color-iron-medium);
    border-radius: 4px;
}

.shop-icon-container .icon.icon-shop,
.shop-icon-container .shop-item-icon {
    width: 85%;
    height: 85%;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    image-rendering: pixelated;
}

/* Shop Spell Icons - Override generic shop container styles to use correct spritesheet positioning */
.shop-icon-container .icon.icon-shop.icon-spell-fireball {
    background-image: url('./sprites/projectiles.png') !important;
    background-size: 300% 100% !important;
    background-position: 100% 0% !important;
}

.shop-icon-container .icon.icon-shop.icon-spell-flameWave {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 0% 0% !important;
}

.shop-icon-container .icon.icon-shop.icon-spell-frostNova {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 25% 0% !important;
}

.icon-spell-flameWave,
.icon-spell-frostNova,
.icon-spell-heal {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
}

/* Projectile Styles */
.projectile {
    position: fixed;
    pointer-events: none;
    z-index: 2000;
    background-image: url('./sprites/projectiles.png');
    background-repeat: no-repeat;
    image-rendering: pixelated;
    width: 40px;
    height: 40px;
}

.projectile.arrow {
    background-size: 300% 100%;
    background-position: 0% 0%;
}

.projectile.net {
    background-size: 300% 100%;
    background-position: 50% 0%;
}

.projectile.fireball {
    background-size: 300% 100%;
    background-position: 100% 0%;
}

.shop-icon-container .icon.icon-shop.icon-spell-heal {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 50% 0% !important;
}

/* Round 11: DEFINITIVE Passive Icon Fix - Highest Specificity Overrides */
.shop-item[data-item-id="tactical_command"] .icon-shop,
.icon-skill-tacticalcommand {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 25% 50% !important;
    background-repeat: no-repeat !important;
}

.shop-item[data-item-id="loot_hoarder"] .icon-shop,
.icon-skill-loothoarder {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 50% 50% !important;
    background-repeat: no-repeat !important;
}

.shop-item[data-item-id="evasion"] .icon-shop,
.icon-skill-evasion {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 75% 50% !important;
    background-repeat: no-repeat !important;
}

.shop-item[data-item-id="thorns"] .icon-shop,
.icon-skill-thorns {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 100% 50% !important;
    background-repeat: no-repeat !important;
}

.shop-item[data-item-id="vampiric_aura"] .icon-shop,
.icon-skill-vampiricaura {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 0% 100% !important;
    background-repeat: no-repeat !important;
}

/* Round 9: HYPER-SPECIFIC OVERRIDE for Passive Skills */
.shop-item span.icon[class*="icon-skill-"],
.troops-tab-content span.icon[class*="icon-skill-"],
.character-roster-item span.icon[class*="icon-skill-"],
#character-roster span.icon[class*="icon-skill-"],
span.icon.icon-shop[class*="icon-skill-"],
span.icon[class*="icon-skill-"] {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-repeat: no-repeat !important;
    display: inline-block !important;
}

/* MASTER POSITIONS - Row 1 is 50%, Row 2 is 100% */
.icon-skill-tacticalcommand {
    background-position: 25% 50% !important;
}

.icon-skill-loothoarder {
    background-position: 50% 50% !important;
}

.icon-skill-evasion {
    background-position: 75% 50% !important;
}

.icon-skill-thorns {
    background-position: 100% 50% !important;
}

.icon-skill-vampiricaura {
    background-position: 0% 100% !important;
}

.icon-skill-goldmagnet {
    background-position: 25% 100% !important;
}

/* Legacy / Fallback for Gold Magnet (if class is icon-goldmagnet) */
.icon-goldmagnet {
    background-image: var(--spritesheet-items) !important;
    background-size: 400% 500% !important;
    background-position: 33.33% 25% !important;
}

/* Row 2, Col 0 */

/* Equipment Icons - Target .icon generic class as they lack .icon-shop */
.shop-icon-container .icon.icon-warbow {
    background-image: url('./sprites/items.png') !important;
    background-size: 400% 500% !important;
    background-position: 33.33% 75% !important;
}

.shop-icon-container .icon.icon-flame-ring {
    background-image: url('./sprites/items.png') !important;
    background-size: 400% 500% !important;
    background-position: 100% 75% !important;
}

.shop-icon-container .icon.icon-flame-cloak {
    background-image: url('./sprites/items.png') !important;
    background-size: 400% 500% !important;
    background-position: 0% 100% !important;
}

/* Rogue Quick Strike (Armory) - skills.png Col 0 Row 1 */
.shop-icon-container .icon.icon-ability-quickStrike {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 0% 50% !important;
}

/* Wizard Polymorph (Armory) - skills.png Col 4 Row 0 */
.shop-icon-container .icon.icon-spell-polymorph {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 100% 0% !important;
    background-repeat: no-repeat !important;
}

.shop-item h4 {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 1.25em;
    margin: 0 0 10px 0;
    color: var(--color-text-main);
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.85);
    gap: 4px;
}

.shop-item h4 span:not(.shop-icon-container) {
    display: block;
}

.shop-item p.shop-cost-line {
    margin: 6px 0 12px 0;
    font-weight: bold;
    color: var(--color-text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    gap: 4px;
}

.shop-item-cost {
    color: var(--color-gold-light);
    font-weight: bold;
}

.shop-item p.shop-item-description {
    font-size: 0.95rem;
    color: var(--color-text-muted);
    margin-top: 0;
    margin-bottom: 0;
    padding-top: 0;
}

.shop-item.locked:not([data-type="armor"]):not(.shop-item-locked) {
    opacity: 0.5;
    filter: grayscale(90%) contrast(0.7);
    cursor: not-allowed !important;
}

.shop-item.maxed {
    opacity: 0.6;
    background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.6));
    border-color: rgba(255, 255, 255, 0.05);
    cursor: not-allowed !important;
}

/* Ensure active passives (which are technically "maxed") stay IDENTICAL to unpurchased cards */
.shop-item[data-type="passive_purchase"].maxed,
.shop-item[data-type="passive"].maxed {
    opacity: 1 !important;
    background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.45)) !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
    filter: none !important;
    cursor: default !important;
}

/* Tactical Command - Legacy class support */
.shop-icon-container .icon.icon-shop.icon-tacticalcommand {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 25% 100% !important;
}

.shop-item[data-type="armor"].hidden {
    display: none;
}

.shop-item[data-type="armor"].active-armor {
    border-color: var(--color-success);
    box-shadow: 0 0 8px var(--color-success), inset 0 0 4px var(--color-success);
    background: linear-gradient(rgba(60, 180, 60, 0.1), rgba(40, 130, 40, 0.2));
}

p.shop-item-resistance {
    font-size: 0.95rem;
    color: var(--color-gold-light);
    margin-top: 0;
    font-style: italic;
}

.text-red {
    color: var(--color-error, #ff4444);
}

/* Par HUD Container */
.hud-par-container {
    position: absolute;
    /* Move it back to game board area on desktop using fixed coordinates relative to screen if it was moved */
    /* Since it's now inside the ui-panel (which is on the right), we need to override it to appear on the left board */
    bottom: calc(20px + var(--control-bar-height, 0px));
    left: calc(-100% - 20px);
    /* Adjust based on actual panel width if necessary, or use fixed coords */
    /* Safer approach for desktop: absolute position relative to its new parent but shifted far left */
    /* However, 'left' might be tricky if ui-panel's left edge isn't constant. */
    /* Better: Use absolute position relative to body/container if possible. */
    /* For now, let's assume it's in the side panel and use specific desktop overrides. */
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(0, 0, 0, 0.75);
    padding: 8px 16px;
    border-radius: 30px;
    border: 2px solid var(--color-gold);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8), 0 0 10px rgba(212, 175, 55, 0.3);
    z-index: 1000;
    pointer-events: auto;
    transition: all 0.3s ease;
    backdrop-filter: blur(4px);
    width: max-content;
}

/* Specific Desktop Override to keep it on the board */
@media (min-width: 701px) {
    .hud-par-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 2000;
    }
}

.hud-par-container .par-icon,
.hud-par-container .par-text,
.hud-par-container .par-bonus {
    pointer-events: none;
}

.hud-par-container .par-icon {
    width: auto;
    height: auto;
    font-size: 1.8rem;
    color: #ffda44;
    /* Bright yellow lightning */
    text-shadow: 0 0 10px rgba(255, 218, 68, 0.6);
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background-image: none !important;
    /* Remove any sprite backgrounds */
}


.bonus-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 10px;
    text-align: center;
}

.bonus-item .bonus-icon {
    width: 48px;
    height: 48px;
    margin-bottom: 8px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
}

.bonus-value-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 1.4rem;
    font-weight: bold;
    color: var(--color-gold-light);
}

.bonus-value-container .icon-gold {
    width: 16px;
    height: 16px;
}

.hud-par-container .par-text {
    font-size: 1.8rem;
    font-weight: bold;
    color: #fff;
    text-shadow: 2px 2px 4px #000;
    min-width: 25px;
    text-align: center;
}

.hud-par-container .par-bonus {
    font-size: 1.2rem;
    color: var(--color-gold);
    font-weight: bold;
    text-shadow: 1px 1px 2px #000;
}

.hud-par-container.urgency-low {
    border-color: #ff8800;
    box-shadow: 0 0 15px rgba(255, 136, 0, 0.6);
    animation: urgent-pulse 1s infinite alternate;
}

.hud-par-container.urgency-none {
    border-color: #555;
    opacity: 0.7;
    filter: grayscale(0.8);
}

@keyframes urgent-pulse {
    from {
        transform: scale(1);
    }

    to {
        transform: scale(1.08);
    }
}

.shop-bottom-bar {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
    padding: 10px 20px;
    background: transparent !important;
    border-top: none !important;
    box-shadow: none !important;
    flex-shrink: 0;
    position: relative;
    z-index: 100;
    pointer-events: none;
    width: 100%;
    box-sizing: border-box;
}

.shop-row {
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    width: 100%;
    pointer-events: none;
}

.shop-row>* {
    pointer-events: auto;
    flex: 1;
    max-width: 200px;
    box-sizing: border-box;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0 12px;
}

.shop-tab-button span,
#shop-exit-button span {
    pointer-events: none !important;
}

#shop-selected-item-info {
    font-size: 1.15rem;
    color: var(--color-text-main);
    margin-bottom: 2px;
    min-height: 0;
    /* REMOVE INVISIBLE ROW */
    text-shadow: 1px 1px 2px #000;
    padding: 0 10px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 100%;
    text-align: center;
}

#shop-feedback {
    min-height: 0;
    /* REMOVE INVISIBLE ROW */
    font-weight: bold;
    font-size: 1.15rem;
    color: var(--color-text-muted);
    margin-top: 0;
    text-align: center;
    margin-bottom: 5px;
}

#shop-feedback.error {
    color: var(--color-error);
}

#shop-feedback.success {
    color: var(--color-success);
}

#shop-gold-display.gold-display {
    margin: 0;
    padding: 0 12px;
    font-size: 1.1rem;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 80px;
}

#shop-action-button {
    min-width: 100px;
    padding: 0 16px;
    font-size: 1.4rem;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Prevent layout shift: use visibility instead of display:none */
#shop-action-button.hidden {
    visibility: hidden !important;
    display: flex !important;
    /* Keep in flow */
    pointer-events: none !important;
}

/* Scale exit button icon  doubled to 0.8 */
#shop-exit-button .large-icon.icon-icons {
    width: 128px !important;
    height: 128px !important;
    min-width: 128px !important;
    max-width: 128px !important;
    background-size: 500% 500% !important;
    transform: scale(0.8) !important;
    transform-origin: center center !important;
    margin: -13px !important;
}

/* Desktop: Gold + Confirm in bottom row alongside tabs */
@media (min-width: 769px) {
    .shop-row-upper #shop-gold-display {
        position: absolute !important;
        bottom: 10px !important;
        left: 20px !important;
        z-index: 10;
    }

    .shop-row-upper #shop-exit-button {
        position: absolute !important;
        bottom: 5px !important;
        right: 20px !important;
        z-index: 10;
    }

    .shop-row-upper {
        justify-content: center !important;
    }
}

#choose-troops-screen .choose-troops-content {
    max-width: 95%;
    width: 900px;
    gap: 0.4rem;
}

.troops-section {
    width: 100%;
    background-color: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--color-wood-dark);
    border-radius: 6px;
    padding: clamp(0.4rem, 1.5vmin, 0.8rem) clamp(0.6rem, 2vmin, 1.2rem);
    margin-bottom: clamp(0.4rem, 1.5vmin, 1rem);
}

.troops-section h3 {
    color: var(--color-gold-light);
    margin: 0 0 0.8rem 0;
    padding-bottom: 0.4rem;
    border-bottom: 1px solid var(--color-wood-light);
    font-size: clamp(1.4rem, 3.5vmin, 1.7rem);
    text-align: center;
}

.troops-list {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(8px, 2vmin, 15px);
    min-height: 60px;
    align-content: flex-start;
    justify-content: center;
}

#shop-screen .troop-card,
.troop-card {
    position: relative;
    width: 85px !important;
    height: auto !important;
    border: none !important;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
    box-shadow: none !important;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.troop-card:hover {
    transform: scale(1.08);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.6), 0 0 8px var(--color-gold-base), inset 0 1px 2px rgba(255, 255, 255, 0.1);
    z-index: 2;
}

.available-troops .troop-card.disabled {
    cursor: not-allowed;
    opacity: 0.5;
    filter: grayscale(70%);
}

.available-troops .troop-card.disabled:hover {
    transform: scale(1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.1);
    z-index: 1;
}

.troop-card .icon,
.troop-card img {
    width: 85%;
    height: 85%;
    object-fit: contain;
    pointer-events: none;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
}

.troop-count {
    position: absolute;
    top: -2px;
    right: -2px;
    background-color: rgba(0, 0, 0, 0.8);
    color: var(--color-gold-light);
    font-weight: bold;
    font-size: 1.6rem;
    line-height: 1;
    padding: 4px 7px;
    border-radius: 0 0 0 8px;
    border: 1px solid var(--color-gold-dark);
    border-top: none;
    border-right: none;
    text-shadow: 1px 1px 2px black;
    pointer-events: none;
}

#choose-troops-feedback {
    min-height: 1.6em;
    margin: 0.5rem 0;
}

.choose-troops-buttons {
    margin-top: 1rem;
    justify-content: space-between !important;
}

#level-select-troops-button {
    margin: 0;
}



#troops-back-button {
    margin-right: auto;
}

#confirm-troops-button {
    margin-left: auto;
}

#tooltip {
    position: fixed;
    background: rgba(40, 30, 20, 0.98);
    /* Darker wood/black mix */
    color: var(--tooltip-text);
    border: 2px solid var(--tooltip-border);
    border-radius: 7px;
    padding: 12px 18px;
    font-size: 1.5rem;
    line-height: 1.3;
    z-index: 10000;
    pointer-events: none;
    white-space: normal;
    opacity: 0;
    transition: opacity 0.15s ease-in-out;
    transform: translate(15px, 20px);
    max-width: 320px;
    box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.4), var(--tooltip-shadow);
    pointer-events: none !important;
}

#tooltip.visible {
    opacity: 1;
}

#tooltip b {
    color: var(--color-gold-light);
    display: inline;
    margin-bottom: 0;
    font-size: 1.25em;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.6);
}

#tooltip span[style*="color:"] {
    font-style: italic;
    font-weight: bold;
    /* filter: brightness(1.15); Removed to match exact shop colors */
}

#tooltip .unit-hp-bar-container.tooltip-hp-bar {
    margin-top: 9px;
}

@media (max-width: 700px),
(max-height: 500px),
(max-aspect-ratio: 1/1) {
    :root {
        font-size: clamp(10px, 2.3vmin, 15px);
        --level-dot-size: clamp(36px, 5vmin, 45px);
        --icon-button-size: 40px;
        --ui-panel-width: 100%;
    }

    #game-container {
        flex-direction: column;
        padding: 6px;
        gap: 6px;
        border-width: 8px;
    }

    #game-board-wrapper {
        width: 100%;
        height: auto;
        aspect-ratio: var(--board-aspect-ratio, 0.8);
        flex-grow: 0;
        flex-shrink: 0;
    }

    #board-feedback-area {
        font-size: clamp(1.8rem, 3.8vmin, 2.4rem);
        padding: 10px 16px;
        gap: 10px;
        border-radius: 10px;
        border-width: 1px;
    }

    #ui-panel {
        width: 100%;
        border-left: none;
        border-top: 6px solid var(--color-wood-darkest);
        border-image: linear-gradient(to right, #6d5b4b, #3b2e1e 90%) 1;
        min-height: 150px;
        max-height: 55vh;
        flex-grow: 1;
        flex-shrink: 1;
        height: auto;
    }

    .panel-content-wrapper {
        padding: 0.9rem;
        gap: 0.9rem;
        height: auto;
        flex-grow: 1;
        min-height: 0;
        overflow-y: auto;
        overflow-x: hidden;
    }

    #top-bar-ui {
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        align-items: center;
        gap: 10px;
        grid-template-columns: unset;
        grid-template-rows: unset;
        grid-template-areas: unset;
        padding-bottom: 5px;
        margin-bottom: 5px;
    }

    #level-display,
    #menu-button {
        grid-area: unset;
    }

    #level-display {
        flex-shrink: 0;
        justify-self: unset;
        padding: 0.5rem 0.9rem;
        font-size: 1.3rem;
    }

    #menu-button {
        margin-left: auto;
        justify-self: unset;
        align-self: center;
    }

    #unit-info {
        flex-shrink: 0;
        padding: 1rem;
        gap: 8px 12px;
        flex-wrap: nowrap;
        grid-template-columns: auto 1fr;
    }

    #unit-portrait {
        width: 60px;
        height: 60px;
        flex-shrink: 0;
        border-width: 4px;
    }

    #unit-details {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 0 12px;
        flex-grow: 1;
        flex-shrink: 1;
        min-width: 0;
        font-size: 1.2rem;
        align-items: center;
    }

    #unit-name {
        grid-column: 1 / span 2;
        font-size: 1.4rem;
        word-wrap: break-word;
    }

    #unit-info p {
        grid-column: 1;
        font-size: 1.1rem;
        word-wrap: break-word;
        margin: 0.2rem 0;
    }

    #unit-abilities {
        grid-column: 2;
        grid-row: 2 / 5;
        margin: 0 !important;
        justify-content: center;
        align-self: center;
    }

    #unit-status {
        grid-column: 1 / span 2;
        word-wrap: break-word;
        font-size: 1.1rem;
    }

    #unit-info .unit-hp-bar-container.info-panel-hp-bar {
        height: 16px;
    }

    #spell-area {
        grid-template-columns: repeat(4, 1fr);
        flex-shrink: 0;
        margin-top: auto;
        gap: 8px;
        padding: 0.9rem;
    }

    .spell-icon {
        width: clamp(36px, 6vmin, 42px);
        height: clamp(36px, 6vmin, 42px);
    }

    .spell-label {
        font-size: 0.9rem;
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .end-turn-style {
        flex-shrink: 0;
        padding: 1.0rem 1.2rem;
        font-size: 1.4rem;
    }

    .overlay {
        padding: 10px;
    }

    .styled-overlay-content {
        width: 95%;
        max-width: 95%;
        padding: clamp(1.6rem, 5.5vmin, 3rem);
        gap: clamp(1.2rem, 3.5vmin, 2rem);
        border-width: 8px;
        border-radius: 6px;
    }

    .decorative-frame {
        top: -1px;
        left: -1px;
        right: -1px;
        bottom: -1px;
        border-width: 1px;
        box-shadow: inset 0 0 3px 1px rgba(0, 0, 0, 0.6), 0 0 0 2px var(--color-iron-black);
    }

    .overlay-title {
        font-size: clamp(2.2rem, 6.5vmin, 3rem);
        padding: 0.6rem 2.2rem;
        margin-top: -1rem;
    }

    .styled-overlay-content p {
        font-size: clamp(1.3rem, 3.6vmin, 1.6rem);
        margin-bottom: 1.2rem;
    }

    .primary-button,
    .secondary-button {
        font-size: clamp(1.5rem, 4vmin, 1.8rem);
        padding: clamp(11px, 2.2vmin, 15px) clamp(20px, 5vmin, 32px);
        min-width: 130px;
    }

    .gold-display {
        font-size: clamp(1.8rem, 4.5vmin, 2.2rem);
        padding: 0.9rem 1.8rem;
    }

    .gold-display .icon-menu {
        width: 1.4em;
        height: 1.4em;
        margin-right: 10px;
    }

    #main-menu .main-menu-background {
        padding: 10px;
        justify-content: center;
    }

    #main-menu-title-image {
        width: 95%;
        /* Force 95% width */
        max-width: 800px;
        margin-bottom: 3rem;
        /* More spacing on mobile */
        margin-top: 0;
    }

    .main-menu-buttons {
        min-width: clamp(230px, 70%, 320px);
        gap: 1.1rem;
        margin-bottom: 0;
    }

    .main-menu-buttons .primary-button {
        font-size: clamp(1.7rem, 4.2vmin, 2rem);
        padding: 14px 22px;
    }

    .level-complete-buttons,
    .game-over-buttons {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
        width: 100%;
    }

    .inset-panel {
        padding: 1.1rem;
    }

    #level-complete-stats p {
        font-size: 1.5rem;
    }

}

#leaderboard-list li {
    padding: 11px 16px;
    font-size: clamp(1.2rem, 3.2vmin, 1.5rem);
    margin-bottom: 8px;
}

#level-select-pagination {
    bottom: 70px;
    padding: 6px 10px;
    gap: 15px !important;
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    align-items: center !important;
    width: 100%;
    pointer-events: none;
    /* Let buttons handle events */
}

#level-select-pagination.hidden {
    display: none !important;
}

#level-select-pagination .pagination-button {
    pointer-events: auto;
}



.level-select-bottom-bar {
    padding: 4px 22px;
    gap: 15px;
    border-top-width: 1px;
    justify-content: flex-start;
}

.level-select-bottom-bar #level-select-shop-button {
    margin-left: auto;
}

.level-select-bottom-bar .primary-button,
.level-select-bottom-bar .secondary-button {
    font-size: clamp(1.4rem, 3.5vmin, 1.6rem);
    font-weight: bold;
}

#shop-screen .shop-content {
    max-width: 98%;
    width: 98%;
    height: 98vh;
    max-height: 98vh;
    border: none !important;
}

#shop-screen .overlay-scroll-container.troops-mode-v2 {
    padding-top: 5px !important;
    gap: 0 !important;
}


.pagination-button {
    width: 44px !important;
    height: 44px !important;
    min-width: 44px !important;
    max-width: 44px !important;
    padding: 0 !important;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box !important;
    flex-shrink: 0 !important;
}

.pagination-button:disabled {
    width: 44px !important;
    height: 44px !important;
    min-width: 44px !important;
    max-width: 44px !important;
    padding: 0 !important;
    opacity: 0.5;
    cursor: default;
}

#shop-troops-tab-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    height: calc(100% - 70px) !important;
    /* EXACT same background as #shop-items-container */
    /* background: linear-gradient(rgba(46, 30, 23, 0.9), rgba(30, 20, 15, 0.94)); */
    overflow-y: auto;
    padding: 10px;
    margin-top: 0;
    box-sizing: border-box;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 5;
}

.choose-troops-content-inner {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
}

/* CSS for Roster Management (Troops Tab) */
.roster-section {
    padding: 1rem;
    flex: 0 0 auto;
    /* Allow horizontal expansion */
    display: flex;
    flex-direction: column;
    margin-bottom: 2rem;
    align-items: stretch !important;
    text-align: center !important;
}

.roster-section .shop-section-header {
    border-bottom: none !important;
    text-align: center !important;
    padding-left: 0;
    width: 100%;
    margin-bottom: 1.5rem;
}

.troops-list-container {
    gap: 20px;
    min-height: 120px;
    justify-content: center !important;
    display: flex;
    flex-wrap: wrap;
    min-width: 0;
    width: 90% !important;
    align-self: center !important;
    max-width: 800px !important;
    margin: 0 auto !important;
    padding: 20px;
    /* Match shop item container style */
    background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.45));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
}

#main-menu .main-menu-bottom-bar {
    padding: 0 15px;
    bottom: 15px;
    width: 100%;
    box-sizing: border-box;
}

#main-menu .bottom-bar-left,
#main-menu .bottom-bar-right {
    gap: 8px;
}

/* CRITICAL FIX V6: Centered & Scoped Mobile Layout */
@media (max-width: 768px) {
    #main-menu .main-menu-bottom-bar {
        justify-content: center !important;
        /* Centered as requested */
        gap: 15px !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        padding-bottom: 20px !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }

    #main-menu .bottom-bar-left,
    #main-menu .bottom-bar-right {
        gap: 15px !important;
        display: flex !important;
        justify-content: center !important;
        flex: 0 1 auto !important;
        /* Shrink to fit content */
    }

    /* Ensure buttons take up space but don't overflow */
    #main-menu .main-menu-bottom-bar button {
        width: 90px !important;
        /* Large target size */
        height: 90px !important;
        padding: 0 !important;
        margin: 0 !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        background: none !important;
        border: none !important;
        overflow: hidden !important;
    }

    #main-menu .main-menu-bottom-bar .large-icon.icon-icons {
        /* Restore original sprite dimensions */
        width: 128px !important;
        height: 128px !important;
        min-width: 128px !important;
        max-width: 128px !important;

        /* Restore correct background size */
        background-size: 500% 500% !important;

        /* Scale down perfectly to ~90px */
        /* 128 * 0.7 = 89.6px */
        transform: scale(0.7) !important;
        transform-origin: center center !important;

        /* Layout hack: negative margins */
        margin: -19px !important;
    }

    /* Larger Enter Button on Mobile */
    /* NUCLEAR FIX: Force Sizes with ID Selectors */
    #start-game-button img {
        width: 85vw !important;
        max-width: 600px !important;
        height: auto !important;
    }

    #main-menu-title-image {
        width: 95vw !important;
        max-width: 800px !important;
        height: auto !important;
        margin-top: 10px !important;
    }
}

/* Mobile: 3-column troop card grid */
@media (max-width: 768px) {
    .troops-list-container {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 0px !important;
        width: 95% !important;
        padding: 10px !important;
        overflow: hidden !important;
        justify-items: center !important;
    }

    .troop-card {
        transform: scale(0.75) !important;
        transform-origin: center center !important;
        margin: -10px !important;
    }
}

/* END MOBILE MEDIA QUERY */

/* General Styles Restored */
.troop-card {
    width: 110px !important;
    height: auto !important;
    border: none !important;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 0 !important;
}

.troop-card-visual {
    width: 110px !important;
    height: 110px !important;
    border: 2px solid rgba(255, 255, 255, 0.15) !important;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(0, 0, 0, 0.35)) !important;
    box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1), 0 6px 15px rgba(0, 0, 0, 0.65) !important;
    outline: none !important;
    display: flex !important;
    justify-content: center;
    align-items: center;
}

.troop-count {
    font-size: 1.4rem;
    padding: 3px 6px;
}

.choose-troops-buttons {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.choose-troops-buttons .primary-button,
.choose-troops-buttons .secondary-button {
    font-size: clamp(1.4rem, 3.5vmin, 1.6rem);
    font-weight: bold;
}

#choose-troops-feedback {
    order: 0;
    flex-grow: 1;
    text-align: center;
    font-size: 1.3rem;
    min-height: 1.6em;
    margin: 0.5rem 0;
}

#troops-back-button {
    order: -1;
    margin: 0;
}

#confirm-troops-button {
    order: 1;
    margin: 0;
}

.settings-container {
    gap: 1rem;
    padding: 1rem;
}

.setting-item label {
    font-size: 1.3rem;
}

.setting-item input[type="range"],
.setting-item input[type="text"] {
    padding: 6px 8px;
}

/* Redundant block removed */

/* Cleaned up mobile achievement styles */

/* Unit icon rules removed - consolidated into master block at line ~1922 */

.shop-item-icon.icon-armor-grey {
    background-position: 0% 0%;
}

.shop-item-icon.icon-armor-green {
    background-position: 25% 0%;
}

.shop-item-icon.icon-armor-red {
    background-position: 50% 0%;
}

.shop-item-icon.icon-armor-yellow {
    background-position: 75% 0%;
}

.shop-item-icon.icon-armor-blue {
    background-position: 100% 0%;
}

.icon-armor-none {
    background-image: none;
}

/* Spell Icons */
/* Legacy icon duplicates removed */

/* Shop Header Layout */
.shop-header-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 10px;
    position: relative;
}

.shop-header-container .shop-title {
    margin-bottom: 0;
    /* Remove bottom margin from title as container handles it */
}

.shop-header-container .gold-display {
    position: static;
    /* Reset any absolute positioning if inherited */
    margin: 0;
    background: rgba(0, 0, 0, 0.3);
    padding: 5px 10px;
    border-radius: 8px;
    border: 1px solid var(--color-gold-dark);
}

/* Attack Animations */
.projectile {
    position: absolute;
    width: var(--cell-size);
    height: var(--cell-size);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    z-index: 100;
    pointer-events: none;
}

.projectile.arrow {
    background-image: url('./sprites/projectiles.png');
    background-size: 200% 100%;
    background-position: 0 0;
}

.projectile.net {
    background-image: url('./sprites/projectiles.png');
    background-size: 200% 100%;
    background-position: 100% 0;
}

.projectile.fireball {
    background-image: url('./sprites/projectiles.png');
    background-size: 300% 100%;
    background-position: 100% 0%;
}

.projectile.boulder {
    background-image: url('./sprites/doodads.png');
    background-size: 400% 500%;
    background-position: 0% 0%;
}

@keyframes melee-lunge {
    0% {
        transform: translate(-50%, -50%);
    }

    50% {
        transform: translate(calc(-50% + var(--lunge-x)), calc(-50% + var(--lunge-y)));
    }

    100% {
        transform: translate(-50%, -50%);
    }
}

.melee-lunge {
    animation: melee-lunge 0.2s ease-in-out;
    z-index: 20;
    /* Bring above other units briefly */
}

@keyframes dropBounce {
    0% {
        transform: var(--base-transform) translateY(-50px);
        opacity: 0;
    }

    20% {
        opacity: 1;
    }

    40% {
        transform: var(--base-transform) translateY(0);
    }

    60% {
        transform: var(--base-transform) translateY(-15px);
    }

    80% {
        transform: var(--base-transform) translateY(0);
    }

    90% {
        transform: var(--base-transform) translateY(-5px);
    }

    100% {
        transform: var(--base-transform) translateY(0);
    }
}

.unit.goblin_mother,
.unit.orc_juggernaut {
    max-height: 85vh;
    overflow-y: auto;
    padding: 20px;
}

.debug-enemy-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 15px;
}

.debug-enemy-button {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    background: linear-gradient(rgba(60, 50, 45, 0.9), rgba(40, 35, 30, 0.95));
    border: 2px solid var(--color-wood-dark);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    aspect-ratio: 1;
}

.debug-enemy-button:hover {
    transform: scale(1.05);
    background: linear-gradient(rgba(80, 70, 60, 0.95), rgba(50, 45, 40, 1));
    border-color: var(--color-gold-base);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.debug-enemy-button.selected {
    background: linear-gradient(rgba(100, 90, 70, 1), rgba(70, 60, 50, 1));
    border-color: var(--color-gold-light);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.5), inset 0 0 10px rgba(255, 215, 0, 0.2);
}

.debug-enemy-sprite {
    width: 60px;
    height: 60px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
    filter: var(--unit-base-shadow);
}

.debug-enemy-button:hover .debug-enemy-sprite {
    filter: var(--unit-hover-shadow) brightness(1.1);
}

#close-debug-spawner-button {
    transition: background-color 0.15s;
}

#game-board.debug-spawn-mode .grid-cell:not(.has-unit):not(.has-obstacle):hover {
    background-color: rgba(255, 165, 0, 0.2) !important;
    box-shadow: inset 0 0 0 2px rgba(255, 165, 0, 0.6) !important;
}

/* Range Outlines */

.enemy-attack-range::after,
.totem-range-grid::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 5;
    /* Borders will be applied here by modifier classes */
}

/* Modifiers apply borders to the pseudo-element so they stack */
.enemy-border-top::after {
    border-top: 2px solid var(--border-red);
}

.enemy-border-bottom::after {
    border-bottom: 2px solid var(--border-red);
}

.enemy-border-left::after {
    border-left: 2px solid var(--border-red);
}

.enemy-border-right::after {
    border-right: 2px solid var(--border-red);
}

.totem-border-top::after {
    border-top: 2px solid var(--border-red);
}

.totem-border-bottom::after {
    border-bottom: 2px solid var(--border-red);
}

.totem-border-left::after {
    border-left: 2px solid var(--border-red);
}

.totem-border-right::after {
    border-right: 2px solid var(--border-red);
}

.totem-border-top {
    box-shadow: inset 0 2px 0 0 var(--border-green), inset 0 0 0 1px var(--bg-heal-weak) !important;
}

.totem-border-bottom {
    box-shadow: inset 0 -2px 0 0 var(--border-green), inset 0 0 0 1px var(--bg-heal-weak) !important;
}

.totem-border-left {
    box-shadow: inset 2px 0 0 0 var(--border-green), inset 0 0 0 1px var(--bg-heal-weak) !important;
}

.totem-border-right {
    box-shadow: inset -2px 0 0 0 var(--border-green), inset 0 0 0 1px var(--bg-heal-weak) !important;
}

/* Unit Variants */
.goblin-green {
    filter: var(--unit-base-shadow);
}

.goblin-red {
    filter: var(--unit-base-shadow);
}

.goblin-blue {
    filter: var(--unit-base-shadow);
}

.goblin-yellow {
    filter: var(--unit-base-shadow);
}

.goblin-purple {
    filter: hue-rotate(240deg) saturate(1.2) drop-shadow(0 0 2px #d000ff) drop-shadow(0 0 5px #d000ff) var(--unit-base-shadow);
}

.goblin-orange {
    filter: hue-rotate(15deg) saturate(1.5) var(--unit-base-shadow);
}

.goblin-gold {
    filter: hue-rotate(35deg) saturate(2) brightness(1.2) drop-shadow(0 0 2px var(--color-gold-light)) drop-shadow(0 0 5px var(--color-gold-light)) var(--unit-base-shadow);
}

.goblin-bloodOrange {
    filter: sepia(1) saturate(6) hue-rotate(360deg) brightness(1.1) contrast(1.4) drop-shadow(0 0 8px rgb(255, 153, 0)) var(--unit-base-shadow);
}


/* Shop Revamp Styles */
.shop-content {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    border-radius: 0 !important;
    display: flex;
    flex-direction: column;
    padding: 10px;
    box-sizing: border-box;
}

.shop-header-container {
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px 10px 10px;
}

.shop-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
    flex-shrink: 0;
}

.shop-tab-button {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--color-wood-light);
    border-radius: 4px;
    color: var(--color-text-muted);
    font-family: inherit;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    padding: 10px 20px;
    transition: all 0.2s;
    position: relative;
}

.shop-tab-button:hover {
    color: var(--color-gold-light);
    background: rgba(255, 255, 255, 0.1);
}

.shop-tab-button.active {
    color: var(--color-gold-light);
    font-weight: bold;
    background: rgba(60, 50, 40, 0.8);
    border-color: var(--color-gold-base);
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

.shop-tab-button.active::after {
    display: none;
}

.shop-tab-button.locked {
    color: var(--color-disabled-text);
    cursor: not-allowed;
}

.shop-tab-button.locked .icon {
    filter: grayscale(100%) opacity(0.5);
}

#shop-items-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    overflow-y: auto;
    padding-right: 10px;
    flex-grow: 1;
    align-content: start;
}

.shop-item {
    width: 100%;
    height: auto;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 15px;
}

.debug-enemy-button {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    background: linear-gradient(rgba(60, 50, 45, 0.9), rgba(40, 35, 30, 0.95));
    border: 2px solid var(--color-wood-dark);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    aspect-ratio: 1;
}

.debug-enemy-button:hover {
    transform: scale(1.05);
    background: linear-gradient(rgba(80, 70, 60, 0.95), rgba(50, 45, 40, 1));
    border-color: var(--color-gold-base);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.debug-enemy-button.selected {
    background: linear-gradient(rgba(100, 90, 70, 1), rgba(70, 60, 50, 1));
    border-color: var(--color-gold-light);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.5), inset 0 0 10px rgba(255, 215, 0, 0.2);
}

.debug-enemy-sprite {
    width: 60px;
    height: 60px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    image-rendering: pixelated;
    filter: var(--unit-base-shadow);
}



#close-debug-spawner-button {
    transition: background-color 0.15s;
}


/* Bonus List Layout Update */
#stats-bonus-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    padding: 0;
    list-style: none;
    margin-top: 10px;
}

.bonus-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 5px;
}

.bonus-value-container {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-top: 5px;
}

.hover-border-yellow-right {
    box-shadow: inset -2px 0 0 rgba(255, 215, 0, 0.6) !important;
}


.hover-border-yellow-top {
    box-shadow: inset 0 2px 0 rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-bottom {
    box-shadow: inset 0 -2px 0 rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-left {
    box-shadow: inset 2px 0 0 rgba(255, 215, 0, 0.6) !important;
}

/* Victory Screen Bonus Icons */
.bonus-icon {
    display: inline-block;
    width: 51px;
    /* 20% smaller than 64px */
    height: 51px;
    background-repeat: no-repeat;
    background-size: 500% 500% !important;
    background-position: 0% 0%;
    vertical-align: middle;
    margin: 0;
}

.icon-bonus-flawlessvictory {
    background-image: url('./sprites/icons.png');
    background-position: 50% 0% !important;
    /* Row 0 Col 2 -> 50% in 5-col */
}

.icon-bonus-nomanleftbehind {
    background-image: url('./sprites/icons.png');
    background-position: 0% 0% !important;
    /* Row 0 Col 0 */
}

.icon-bonus-mightovermagic {
    background-image: url('./sprites/icons.png');
    background-position: 25% 0% !important;
    /* Row 0 Col 1 -> 25% in 5-col */
}

.icon-bonus-ultimate {
    background-image: url('./sprites/icons.png');
    background-position: 75% 0% !important;
    /* Row 0 Col 3 -> 75% in 5-col */
}

.shop-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
    flex-shrink: 0;
}

.shop-tab-button {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid var(--color-wood-light);
    border-radius: 4px;
    color: var(--color-text-muted);
    font-family: inherit;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    padding: 10px 20px;
    transition: all 0.2s;
    position: relative;
}

.shop-tab-button:hover {
    color: var(--color-text-main);
    background: rgba(255, 255, 255, 0.1);
}

.shop-tab-button.active {
    color: var(--color-gold-light);
    font-weight: bold;
    background: rgba(60, 50, 40, 0.8);
    border-color: var(--color-gold-base);
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

.shop-tab-button.active::after {
    display: none;
}

.shop-tab-button.locked {
    color: var(--color-disabled-text);
    cursor: not-allowed;
}

.shop-tab-button.locked .icon {
    filter: grayscale(100%) opacity(0.5);
}

#shop-items-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    overflow-y: auto;
    padding-right: 10px;
    flex-grow: 1;
    align-content: start;
}

.shop-item {
    width: 100%;
    height: auto;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.shop-item.hidden-tab {
    display: none !important;
}

.shop-section-header.hidden-tab {
    display: none !important;
}

/* Range Outlines - Selection */
/* Redundant definitions removed */

/* Prominent spell target highlight for enemies in range */
.spell-target-highlight {
    border: 3px solid rgba(255, 50, 50, 0.9) !important;
    box-shadow: inset 0 0 8px rgba(255, 50, 50, 0.5), 0 0 6px rgba(255, 50, 50, 0.4) !important;
    animation: spell-target-pulse 1s ease-in-out infinite !important;
}

@keyframes spell-target-pulse {

    0%,
    100% {
        box-shadow: inset 0 0 8px rgba(255, 50, 50, 0.5), 0 0 6px rgba(255, 50, 50, 0.4);
    }

    50% {
        box-shadow: inset 0 0 12px rgba(255, 50, 50, 0.7), 0 0 10px rgba(255, 50, 50, 0.6);
    }
}

/* Range Outlines - Hover */
.hover-border-yellow-top {
    border-top: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-bottom {
    border-bottom: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-left {
    border-left: 2px solid rgba(255, 215, 0, 0.6) !important;
}

/* Duplicate icon rules removed */

/* Condensed Menu Styles */
#menu-overlay .overlay-content {
    max-width: 600px;
    min-width: 400px;
    padding: 30px;
    max-height: 90vh;
}

#menu-overlay .overlay-scroll-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

#menu-title {
    margin: 0 0 10px 0;
    font-size: 2.2rem;
    text-align: center;
}

#menu-gold-display {
    margin: 0 0 20px 0;
    padding: 12px 24px;
    font-size: 1.4rem;
    border-radius: 8px;
}

#menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
    align-items: stretch;
}

.menu-icon-row {
    display: flex;
    gap: 16px;
    justify-content: center;
    width: 100%;
}

#menu-overlay .icon-button {
    min-width: 80px;
    width: 80px;
    height: 80px;
    padding: 0;
    font-size: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-grow: 0;
    flex-shrink: 0;
    border-radius: 8px;
    transition: all 0.2s ease;
}

#menu-overlay .icon-button:hover {
    transform: scale(1.05);
}

#menu-overlay .icon-button:active {
    transform: scale(0.95);
}

#menu-overlay .primary-button:not(.icon-button),
#menu-overlay .secondary-button {
    margin: 0;
    padding: 16px 24px;
}

.level-complete-buttons {
    display: flex;
    gap: 12px;
    width: 100%;
    margin-top: 5px;
}

.level-complete-buttons button {
    flex: 1;
    color: var(--color-text-muted);
    font-family: inherit;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    padding: 10px 20px;
    transition: all 0.2s;
    position: relative;
}

.shop-tab-button:hover {
    color: var(--color-text-main);
    background: rgba(255, 255, 255, 0.1);
}

.shop-tab-button.active {
    color: var(--color-gold-light);
    font-weight: bold;
    background: rgba(60, 50, 40, 0.8);
    border-color: var(--color-gold-base);
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

.shop-tab-button.active::after {
    display: none;
}

.shop-tab-button.locked {
    color: var(--color-disabled-text);
    cursor: not-allowed;
}

.shop-tab-button.locked .icon {
    filter: grayscale(100%) opacity(0.5);
}

#shop-items-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    overflow-y: auto;
    padding-right: 10px;
    flex-grow: 1;
    align-content: start;
}

.shop-item {
    width: 100%;
    height: auto;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.shop-item.hidden-tab {
    display: none !important;
}

.shop-section-header.hidden-tab {
    display: none !important;
}

/* Range Outlines - Selection */
/* Redundant definitions removed */

/* Range Outlines - Hover */
.hover-border-yellow-top {
    border-top: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-bottom {
    border-bottom: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-left {
    border-left: 2px solid rgba(255, 215, 0, 0.6) !important;
}

/* Duplicate icon rules removed */

/* Condensed Menu Styles */
#menu-overlay .overlay-content {
    max-width: 600px;
    min-width: 400px;
    padding: 30px;
    max-height: 90vh;
}

#menu-overlay .overlay-scroll-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

#menu-title {
    margin: 0 0 10px 0;
    font-size: 2.2rem;
    text-align: center;
}

#menu-gold-display {
    margin: 0 0 20px 0;
    padding: 12px 24px;
    font-size: 1.4rem;
    border-radius: 8px;
}

#menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
    align-items: stretch;
}

.menu-icon-row {
    display: flex;
    gap: 16px;
    justify-content: center;
    width: 100%;
}

#menu-overlay .icon-button {
    min-width: 80px;
    width: 80px;
    height: 80px;
    padding: 0;
    font-size: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-grow: 0;
    flex-shrink: 0;
    border-radius: 8px;
    transition: all 0.2s ease;
}

#menu-overlay .icon-button:hover {
    transform: scale(1.05);
}

#menu-overlay .icon-button:active {
    transform: scale(0.95);
}

#menu-overlay .primary-button:not(.icon-button),
#menu-overlay .secondary-button {
    margin: 0;
    padding: 16px 24px;
}

.level-complete-buttons {
    display: flex;
    gap: 12px;
    width: 100%;
    margin-top: 5px;
}

.level-complete-buttons button {
    flex: 1;
    color: var(--color-text-muted);
    font-family: inherit;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    padding: 10px 20px;
    transition: all 0.2s;
    position: relative;
}

.shop-tab-button:hover {
    color: var(--color-text-main);
    background: rgba(255, 255, 255, 0.1);
}

.shop-tab-button.active {
    color: var(--color-gold-light);
    font-weight: bold;
    background: rgba(60, 50, 40, 0.8);
    border-color: var(--color-gold-base);
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

.shop-tab-button.active::after {
    display: none;
}

.shop-tab-button.locked {
    color: var(--color-disabled-text);
    cursor: not-allowed;
}

.shop-tab-button.locked .icon {
    filter: grayscale(100%) opacity(0.5);
}

#shop-items-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    overflow-y: auto;
    padding-right: 10px;
    flex-grow: 1;
    align-content: start;
}

.shop-item {
    width: 100%;
    height: auto;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.shop-item.hidden-tab {
    display: none !important;
}

.shop-section-header.hidden-tab {
    display: none !important;
}

/* Range Outlines - Selection */
/* Redundant definitions removed */

/* Range Outlines - Hover */
.hover-border-yellow-top {
    border-top: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-bottom {
    border-bottom: 2px solid rgba(255, 215, 0, 0.6) !important;
}

.hover-border-yellow-left {
    border-left: 2px solid rgba(255, 215, 0, 0.6) !important;
}

/* Duplicate icon rules removed */

/* Condensed Menu Styles */
#menu-overlay .overlay-content {
    max-width: 600px;
    min-width: 400px;
    padding: 30px;
    max-height: 90vh;
}

#menu-overlay .overlay-scroll-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

#menu-title {
    margin: 0 0 10px 0;
    font-size: 2.2rem;
    text-align: center;
}

#menu-gold-display {
    margin: 0 0 20px 0;
    padding: 12px 24px;
    font-size: 1.4rem;
    border-radius: 8px;
}

#menu-buttons-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    width: 100%;
    align-items: stretch;
}

.menu-icon-row {
    display: flex;
    gap: 16px;
    justify-content: center;
    width: 100%;
}

#menu-overlay .icon-button {
    min-width: 80px;
    width: 80px;
    height: 80px;
    padding: 0;
    font-size: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-grow: 0;
    flex-shrink: 0;
    border-radius: 8px;
    transition: all 0.2s ease;
}

#menu-overlay .icon-button:hover {
    transform: scale(1.05);
}

#menu-overlay .icon-button:active {
    transform: scale(0.95);
}

#menu-overlay .primary-button:not(.icon-button),
#menu-overlay .secondary-button {
    margin: 0;
    padding: 16px 24px;
}

.level-complete-buttons {
    display: flex;
    gap: 12px;
    width: 100%;
    margin-top: 5px;
}

.level-complete-buttons button {
    flex: 1;
    padding: 14px 20px;
    font-size: 1.1rem;
}

/* Frost Nova Preview */
.frost-nova-preview {
    background-color: rgba(100, 200, 255, 0.4) !important;
    box-shadow: inset 0 0 10px rgba(68, 121, 255, 0.719);
    position: relative;
}

.frost-nova-preview::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: 1px solid rgba(150, 220, 255, 0.6);
    pointer-events: none;
}

/* Shop Item Colors & Locked State */
.shop-item.locked:not(.shop-item-locked) {
    filter: grayscale(100%) brightness(0.7);

}

/* Spell Icons */
/* Legacy spell icons removed (defined at line ~1405) */

.icon-spell-forestArmor {
    background-image: url('./sprites/armor.png') !important;
    background-position: 25% 0% !important;
    background-size: 500% 100% !important;
    /* Reinforce sizing to match spell-icon exactly */
    width: clamp(40px, 7vmin, 50px) !important;
    height: clamp(40px, 7vmin, 50px) !important;
}

/* Armor Icons */
.icon-armor {
    background-image: var(--spritesheet-armor-icons);
    background-size: 500% 100%;
}

.icon-armor-none {
    background-image: none;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px dashed #666;
}

.icon-armor-grey {
    background-position: 0% 0%;
}

.icon-armor-green {
    background-position: 25% 0%;
}

.icon-armor-red {
    background-position: 50% 0%;
}

.icon-armor-yellow {
    background-position: 75% 0%;
}

.icon-armor-blue {
    background-position: 100% 0%;
}

/* Restored Icon Styles */
.icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    vertical-align: middle;
}

/* Item Icons */
.icon-warbow {
    background-image: var(--spritesheet-items);
    background-position: 33.33% 75%;
    background-size: 400% 500%;
}

.icon-gold {
    background-image: var(--spritesheet-items);
    background-position: 0% 25%;
    background-size: 400% 500%;
}

.icon-goldmagnet {
    background-image: var(--spritesheet-items);
    background-position: 33.33% 25%;
    background-size: 400% 500%;
}

/* Consolidated Item Icons */
.icon-potion,
.icon-gem,
.icon-spellbook,
.icon-flame-cloak,
.icon-flame-ring,
.icon-net {
    background-image: var(--spritesheet-items);
    background-size: 400% 500%;
    background-repeat: no-repeat;
}

.icon-potion {
    background-position: 0% 50%;
}

.icon-gem {
    background-position: 33.33% 50%;
}

.icon-spellbook {
    background-position: 0% 75%;
}

.icon-tome-of-chain-lightning {
    background-position: 0% 75%;
    /* Row 3, Col 0 */
    filter: brightness(1.1) contrast(1.1) sepia(100%) hue-rotate(150deg) saturate(500%) drop-shadow(0 0 8px cyan) !important;
}

.ice-blue {
    filter: hue-rotate(120deg) saturate(2.5) brightness(1.2) contrast(1.1) drop-shadow(0 0 8px rgba(0, 191, 255, 0.9)) !important;
}

.glacier-arrow {
    filter: hue-rotate(120deg) saturate(5) brightness(1.5) drop-shadow(0 0 5px cyan);
}

.icon-flame-cloak {
    background-position: 0% 100%;
}

.icon-flame-ring {
    background-position: 100% 75%;
}

.icon-glacier-bow {
    background-image: var(--spritesheet-items);
    background-position: 33.33% 100%;
    background-size: 400% 500%;
}

.frost-fireball {
    filter: hue-rotate(180deg) brightness(1.2) saturate(1.5);
}

.shop-icon-container .icon.icon-glacier-bow {
    background-image: url('./sprites/items.png') !important;
    background-size: 400% 500% !important;
    background-position: 33.33% 100% !important;
}

.icon-net {
    background-position: 33.33% 75%;
}

/* Fix for netted unit visual centering */
.unit.netted::after {
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    transform: translate(-50%, -50%);
    z-index: 5;
}

/* Fix for frozen filter disappearing on hover for selected units */
.unit.frozen.selected.player:hover {
    filter: var(--frozen-filter) var(--hover-player-filter-outline) var(--selected-filter-outline) var(--unit-hover-shadow) brightness(1.05);
}

.unit.frozen.selected.enemy:hover {
    filter: var(--frozen-filter) var(--hover-enemy-filter-outline) var(--selected-filter-outline) var(--unit-hover-shadow) brightness(1.05);
}

/* Icons Sprite Sheet Integration */
.icon-sprite {
    background-image: url('./sprites/icons.png');
    background-size: 800px 400px;
    /* 4 columns x 200px, 2 rows x 200px */
    width: 200px;
    height: 200px;
    display: inline-block;
    background-repeat: no-repeat;
}

/* Redundant bonus icon block removed - see line ~4783 */

/* New Icons Sprite Sheet (400x500px, 4 columns, 5 rows, 100x100px each) */
.icon-icons,
.icon-short {
    display: inline-block;
    vertical-align: middle;
    background-repeat: no-repeat;
    image-rendering: pixelated;
    width: 1.5em;
    height: 1.5em;
    background-size: 500% 500%;
}

.icon-icons {
    background-image: var(--spritesheet-icons);
}

.icon-short {
    background-image: var(--spritesheet-icons-short);
    background-size: 300% 300%;
    height: 0.9em;
}

.icon-backdrop {
    background-position: 75% 25%;
}

/* r0, c4 */
.icon-executioner-bonus {
    background-image: var(--spritesheet-icons) !important;
    background-position: 100% 0% !important;
}

/* r1, c0 */
.icon-blitz-bonus {
    background-image: var(--spritesheet-icons) !important;
    background-position: 0% 25% !important;
}

/* r2, c3 */
.icon-home {
    background-position: 75% 50%;
}

/* r1, c3 */

.icon-options {
    background-position: 0% 50%;
}

/* r2, c0 */
.icon-leaderboard {
    background-position: 25% 50%;
}

/* r2, c1 */
.icon-achievements {
    background-position: 50% 50%;
}

/* r2, c2 */
.icon-ui-gold {
    background-position: -200px -320px;
}

.icon-hourglass {
    background-position: -240px -320px;
}

/* r2, c3 */

.icon-hamburger {
    background-position: 0% 75%;
}

/* r3, c0 */
.icon-fullscreen {
    background-position: 25% 75%;
}

/* r3, c1 */
.icon-unfullscreen {
    background-position: 50% 75%;
}

/* r3, c2 */
.icon-confirm {
    background-position: 75% 75%;
}

/* r3, c3 */

.icon-back {
    background-position: 0% 100%;
}

/* r4, c0 */
.icon-restart {
    background-position: 25% 100%;
}

/* r4, c1 */
.icon-unmute {
    background-position: 50% 100%;
}

/* r4, c2 */
.icon-mute {
    background-position: 75% 100%;
}

/* r4, c3 */

.icon-button .icon-icons,
.icon-button .icon-short {
    width: 24px;
    height: 24px;
}

.icon-button .icon-short {
    height: 14.4px;
}

.shop-tab-button .icon-short {
    width: 48px;
    height: 29px;
    margin-right: 0;
}

.secondary-button .icon-icons {
    margin-right: 5px;
}

.primary-button .icon-icons {
    margin-right: 8px;
}

.icon-label {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    user-select: none;
}

.icon-label input[type="checkbox"] {
    display: none;
}

/* New Short Icons Sprite Sheet (300x180px, 3 columns, 3 rows, 100x60px each) */
.icon-short {
    background-image: var(--spritesheet-icons-short);
    background-size: 300% 300%;
}

.icon-shop-tab {
    background-position: 0% 0%;
}

/* r0, c0 */
.icon-armory-tab {
    background-position: 50% 0%;
}

/* r0, c1 */
.icon-troops-tab {
    background-position: 100% 0%;
}

/* r0, c2 */

.icon-arrow-left {
    background-position: 0% 50%;
}

/* r1, c0 */
.icon-arrow-right {
    background-position: 50% 50%;
}

/* r1, c1 */
.icon-fit-width {
    background-position: 100% 50%;
}

/* r1, c2 */

.icon-barracks {
    background-position: 0% 100%;
}

/* r2, c0 */

/* Terrain Tiles Sprite Sheet Integration */
.tile-sprite {
    background-image: url('./sprites/tiles.png') !important;
    background-size: 1000px 800px !important;
    /* 5 columns x 200px, 4 rows x 200px */
    background-repeat: no-repeat !important;
}

/* Biome Rows */
.tile-forest {
    background-position-y: 0% !important;
}

.tile-castle {
    background-position-y: 33.33% !important;
}

.tile-desert {
    background-position-y: 66.66% !important;
}

.tile-winter {
    background-position-y: 100% !important;
}

/* Tile Variants (Columns) */
.tile-main {
    background-position-x: 0% !important;
}

.tile-dec1 {
    background-position-x: 25% !important;
}

.tile-dec2 {
    background-position-x: 50% !important;
}

.tile-dec3 {
    background-position-x: 75% !important;
}

.tile-rough {
    background-position-x: 100% !important;
}

/* Fix for tile sizing - override previous rule */
.tile-sprite {
    background-size: 500% 400% !important;
}

/* Fix for tile bleeding - higher precision */
.tile-castle {
    background-position-y: 33.3333% !important;
}

.tile-desert {
    background-position-y: 66.6667% !important;
}

/* Terrain Tiles Sprite Sheet Integration - Pixel Perfect Fix */
.tile-sprite {
    background-image: url('./sprites/tiles.png') !important;
    /* 5 columns, 4 rows relative to cell size */
    background-size: calc(var(--cell-size) * 5) calc(var(--cell-size) * 4) !important;
    background-repeat: no-repeat !important;
}

/* Biome Rows (Y-axis) */
.tile-forest {
    background-position-y: 0px !important;
}

.tile-castle {
    background-position-y: calc(var(--cell-size) * -1) !important;
}

.tile-desert {
    background-position-y: calc(var(--cell-size) * -2) !important;
}

.tile-winter {
    background-position-y: calc(var(--cell-size) * -3) !important;
}

/* Tile Variants (X-axis) */
.tile-main {
    background-position-x: 0px !important;
}

.tile-dec1 {
    background-position-x: calc(var(--cell-size) * -1) !important;
}

.tile-dec2 {
    background-position-x: calc(var(--cell-size) * -2) !important;
}

.tile-dec3 {
    background-position-x: calc(var(--cell-size) * -3) !important;
}

.tile-rough {
    background-position-x: calc(var(--cell-size) * -4) !important;
}

/* Skill Icon Classes */
.icon-skill-flameWave {
    background-position: 0 0;
}

.icon-skill-frostNova {
    background-position: 25% 0;
}

.icon-skill-heal {
    background-position: 50% 0;
}

.icon-skill-arcaneJolt {
    background-position: 75% 0;
}

.icon-skill-polymorph {
    background-position: 100% 0% !important;
    background-repeat: no-repeat !important;
}

.icon-skill-quickStrike {
    background-position: 0 50%;
}

/* Global skill icon positions - Re-synced with master block */
.icon-skill-tacticalcommand {
    background-position: 25% 50%;
}

.icon-skill-loothoarder {
    background-position: 50% 50%;
}

.icon-skill-evasion {
    background-position: 75% 50%;
}

.icon-skill-thorns {
    background-position: 100% 50%;
}

.icon-skill-vampiricaura {
    background-position: 0% 100%;
}

.skill-icon {
    width: 40px;
    height: 40px;
    background-image: var(--spritesheet-skills);
    background-size: 500% 300%;
    display: inline-block;
    image-rendering: pixelated;
}

.icon-skill-stealth {
    width: 40px;
    height: 40px;
    background-image: var(--spritesheet-humans-grey);
    background-position: 75% 0;
    background-size: 400% 100%;
    opacity: 1;
    display: inline-block;
    image-rendering: pixelated;
}

/* Skill icon cooldown/used states - darken the icon */
.skill-icon.locked,
.skill-icon.used {
    filter: grayscale(50%) brightness(0.7);
    opacity: 0.8;
}

.skill-icon.locked:hover,
.skill-icon.used:hover {
    filter: grayscale(30%) brightness(0.8);
    opacity: 0.9;
}

.skill-icon:disabled {
    position: relative;
    overflow: hidden;
}

/* Skill icon selected/active state - gold glow like spells (for targeting mode) */
.skill-icon.selected,
.spell-icon.skill-icon.selected {
    filter: none !important;
    cursor: pointer;
    border-color: var(--color-gold-light) !important;
    box-shadow: 0 0 10px var(--color-gold-light) !important;
    opacity: 1 !important;
}

/* Cooldown number overlay on skills - positioned as sibling in #unit-abilities */
#unit-abilities {
    position: relative;
}

#unit-abilities>.cooldown-overlay {
    position: absolute;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    font-weight: bold;
    text-shadow: 0 0 4px #000, 0 0 8px #000, 2px 2px 2px #000;
    pointer-events: none;
    z-index: 100;
}


/* Cooldown color coding by turns remaining */
.cooldown-overlay.cd-3 {
    color: #ff4444;
    /* Red for 3+ turns */
}

.cooldown-overlay.cd-2 {
    color: var(--color-orange-highlight);
    /* Orange for 2 turns */
}

.cooldown-overlay.cd-1 {
    color: var(--color-gold-light);
    /* Yellow for 1 turn */
}

/* Skill icon passive active state - subtle highlight, no gold glow (e.g. Stealth on) */
.spell-icon.active-state,
.skill-icon.active-state {
    border-color: #88ccff !important;
    box-shadow: 0 0 6px rgba(136, 204, 255, 0.6) !important;
    opacity: 1 !important;
}

/* Rogue portrait as stealth icon with 40% opacity */
#ability-stealth {
    border-radius: 0 !important;
}

#unit-abilities .icon-ability-stealth::before {
    display: none !important;
    /* Completely hide legacy stealth pseudo-element */
    content: '' !important;
}

/* When stealthed, show icon at 100% opacity */
#unit-abilities .icon-ability-stealth.selected::before {
    opacity: 1;
}

/* Override .icon class for Quick Strike button - use skills.png instead of items.png */
#unit-abilities .icon.icon-ability-quickStrike {
    background-image: url('./sprites/skills.png') !important;
    background-size: 500% 300% !important;
    background-position: 0% 50% !important;
}

/* Disabled/locked ability buttons should still show icons, just darkened */
#unit-abilities button:disabled,
#unit-abilities button.locked,
#unit-abilities button.used {
    filter: grayscale(80%) brightness(0.5) !important;
}

/* Keep the icon visible on disabled stealth button */
#unit-abilities .icon-ability-stealth:disabled::before,
#unit-abilities .icon-ability-stealth.locked::before,
#unit-abilities .icon-ability-stealth.used::before {
    opacity: 0.25;
}



/* Goblin variants are handled by logic now */

.valid-attack-target,
.can-be-primary-target {
    box-shadow: inset 0 0 0 2px var(--primary-target-border);
}

/* Chain Lightning animation */
@keyframes lightningFlash {
    0% {
        opacity: 1;
        stroke-width: 4;
    }

    50% {
        opacity: 0.8;
        stroke-width: 3;
    }

    100% {
        opacity: 0;
        stroke-width: 1;
    }
}

/* Green Proceed button styling when level is cleared */
#end-turn-button.next-level-mode {
    background: linear-gradient(180deg, #24cd24 0%, #049f28 50%, #016501 100%);
    border-color: #33cf33 #1a331a #1a331a #6ab06a;
    color: #ffffff;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    animation: proceedPulse 1.5s ease-in-out infinite;
}

#end-turn-button.next-level-mode:hover {
    background: linear-gradient(180deg, #5aa55a 0%, #3d6d3d 50%, #2d4a2d 100%);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

@keyframes proceedPulse {

    0%,
    100% {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 0 0 0 rgba(100, 180, 100, 0.4);
    }

    50% {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 0 0 8px rgba(100, 180, 100, 0);
    }
}

/* Green border for equipped armor and equipment in shop */
.shop-item.active-armor,
.shop-item.active-equipment {
    border: 3px solid #45e700 !important;
    box-shadow: 0 0 12px rgba(74, 222, 128, 0.5), inset 0 0 8px rgba(74, 222, 128, 0.1);
    background: linear-gradient(135deg, rgba(74, 222, 128, 0.15), rgba(74, 222, 128, 0.05));
}

/* Equipment power color classes */
.item-uncommon {
    color: #21f301 !important;
    /* Green - Uncommon */
    text-shadow: 0 0 8px rgba(74, 222, 128, 0.4);
}

.item-rare {
    color: #4facfe !important;
    /* Azure Blue - Rare */
    text-shadow: 0 0 8px rgba(79, 172, 254, 0.4);
}

.item-epic {
    color: #a18cd1 !important;
    /* Purple - Epic */
    text-shadow: 0 0 8px rgba(161, 140, 209, 0.4);
}

.item-legendary {
    color: var(--color-legendary) !important;
    /* Legendary Orange */
    text-shadow: 0 0 10px rgba(240, 165, 44, 0.6);
    font-weight: bold;
}

/* Hover Outlines logic handled in updateUnitVisualState for proper layering */

/* Redundant blocks removed to fix category layout */

/* Gear Overlays */
.unit-gear-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
}

.gear-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-repeat: no-repeat;
}

/* Armory Condensed Layout */
/* Armory Condensed Layout */
#shop-items-container.armory-mode {
    display: flex !important;
    flex-wrap: wrap;
    align-content: flex-start;
    justify-content: flex-start;
    /* Aligned Left */
    gap: 20px;
    padding-left: 20px;
    /* Slight offset from edge */
}

/* Ensure standard shop items (Specializations) usually controlled by Grid get a size in Flex */
#shop-items-container.armory-mode .shop-item:not(.condensed-upgrade) {
    width: 180px;
    /* Approximate look of Grid items */
    flex-grow: 0;
}

#shop-items-container.armory-mode .shop-section-header {
    width: 100%;
    flex-basis: 100%;
    margin-top: 20px;
    margin-bottom: 10px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.armory-unit-card {
    /* Match basic .shop-item styling */
    background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.45));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    box-shadow: 0 4px 9px rgba(0, 0, 0, 0.65);
    width: 360px;
    /* Double width approx */
    display: flex;
    flex-direction: column;
    overflow: hidden;
    /* rounded corners clip */
    margin-bottom: 15px;
    padding: 10px;
    /* slightly less internal padding than shop item so contents fit */
    transition: all 0.2s ease-out;
}


.armory-unit-card:hover {
    /* Subtle hover lift like shop items */
    transform: translateY(-2px);
    box-shadow: 0 9px 18px rgba(0, 0, 0, 0.75);
    border-color: rgba(255, 255, 255, 0.15);
}

.armory-unit-card.hidden-tab {
    display: none !important;
}

.armory-card-header {
    /* Removed custom background/border to blend in */
    background: transparent;
    padding: 5px;
    display: flex;
    flex-direction: column;
    /* Icon atop Name */
    align-items: center;
    justify-content: center;
    gap: 5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    /* very subtle separator */
    margin-bottom: 5px;
}

.armory-card-header h4 {
    margin: 5px 0 0 0;
    font-size: 1.5em;
    /* Match Shop Item Header */
    color: var(--color-text-main);
    text-shadow: 1px 1px 2px black;
}

.armory-card-body {
    display: flex;
    flex: 1;
    gap: 10px;
    /* Space between upgrade columns */
}

/* Individual upgrade "columns" within the card */
.shop-item.condensed-upgrade {
    flex: 1;
    margin: 0;
    border: none;
    border-radius: 4px;
    /* Slight radius for interactions */
    background: transparent;
    padding: 8px 5px;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    transition: background 0.2s;
}

/* Vertical separator line between HP and ATK */
.shop-item.condensed-upgrade:first-child {
    border-right: 1px solid rgba(255, 255, 255, 0.08);
    /* Smoother separator */
}

.shop-item.condensed-upgrade:hover:not(.locked):not(.maxed):not(.selected) {
    background: rgba(255, 255, 255, 0.05);
    transform: none;
    color: var(--color-gold-light);
}

.shop-item.condensed-upgrade:hover:not(.locked):not(.maxed):not(.selected) .condensed-stat-label {
    color: var(--color-gold-light);
}

.shop-item.condensed-upgrade.selected {
    background: rgba(255, 187, 0, 0.15) !important;
    box-shadow: inset 0 0 10px rgba(255, 187, 0, 0.2);
}

.condensed-stat-label {
    font-weight: bold;
    color: var(--color-text-main);
    font-size: 1.2rem;
}

.condensed-cost-line {
    margin: 0;
    font-size: 1.2rem !important;
    /* Slightly smaller than Specializations (1.4rem) */
    /* Match Shop Cost Line Style */
    color: var(--color-text-muted);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
}

.condensed-cost {
    font-weight: bold;
    color: var(--color-gold-light);
}

.shop-item.condensed-upgrade.maxed .condensed-stat-label,
.shop-item.condensed-upgrade.maxed .condensed-cost-line {
    color: var(--color-text-muted);
}

/* Healing Particle Effects */
.particle-heal {
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: var(--popup-heal-color, #44ff44);
    box-shadow: 0 0 6px var(--popup-heal-color, #44ff44);
    border-radius: 50%;
    pointer-events: none;
    z-index: 30;
    opacity: 1;
}

.particle-heal.cross {
    background-color: transparent;
    box-shadow: none;
    width: 12px;
    height: 12px;
}

.particle-heal.cross::before,
.particle-heal.cross::after {
    content: '';
    position: absolute;
    background-color: var(--popup-heal-color, #44ff44);
    box-shadow: 0 0 4px var(--popup-heal-color, #44ff44);
}

.particle-heal.cross::before {
    top: 50%;
    left: 0;
    width: 100%;
    height: 2px;
    transform: translateY(-50%);
}

.particle-heal.cross::after {
    left: 50%;
    top: 0;
    width: 2px;
    height: 100%;
    transform: translateX(-50%);
}

@keyframes heal-particle-rise {
    0% {
        transform: translate(-50%, 0) scale(0.5) rotate(0deg);
        opacity: 0;
    }

    20% {
        opacity: 1;
    }

    100% {
        transform: translate(calc(-50% + var(--drift-x, 0px)), -60px) scale(1.2) rotate(var(--rotation, 180deg));
        opacity: 0;
    }
}

/* Totem Area Pulse Effect */
.totem-heal-pulse {
    position: absolute;
    border-radius: 50%;
    border: 4px solid var(--popup-heal-color, #44ff44);
    background: radial-gradient(circle, rgba(68, 255, 68, 0.2) 0%, transparent 70%);
    pointer-events: none;
    z-index: 5;
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
    animation: totem-pulse-anim 0.8s ease-out forwards;
}

@keyframes totem-pulse-anim {
    0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0.8;
        border-width: 8px;
    }

    100% {
        transform: translate(-50%, -50%) scale(var(--pulse-radius, 5));
        opacity: 0;
        border-width: 1px;
    }
}

/* Forest Armor - Wind Particle (Grey Swirl) */
.particle-wind {
    position: absolute;
    width: 14px;
    height: 3px;
    background-color: rgba(220, 220, 220, 0.8);
    box-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    pointer-events: none;
    z-index: 31;
    opacity: 0;
}

@keyframes forest-wind-swirl {
    0% {
        transform: translate(-50%, -50%) rotate(0deg) translateX(var(--radius, 18px)) rotate(0deg) scale(0);
        opacity: 0;
    }

    10% {
        opacity: 1;
        scale: 1.2;
    }

    90% {
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -50%) rotate(360deg) translateX(var(--radius, 18px)) rotate(-360deg) scale(0.5);
        opacity: 0;
    }
}

/* Forest Armor - Leaf Particle (Green Flutter) */
.particle-leaf {
    position: absolute;
    width: 10px;
    height: 6px;
    background-color: #2e7d32;
    border-radius: 50% 0 50% 0;
    pointer-events: none;
    z-index: 32;
    opacity: 0;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
}

@keyframes forest-particle-flutter {
    0% {
        transform: translate(-50%, 0) rotate(0deg) scale(0);
        opacity: 0;
    }

    20% {
        opacity: 1;
        transform: translate(calc(-50% + var(--drift-x, 0px)), -10px) rotate(45deg) scale(1);
    }

    80% {
        opacity: 1;
    }

    100% {
        transform: translate(calc(-50% + var(--drift-x, 0px) * 2), -40px) rotate(180deg) scale(0.5);
        opacity: 0;
    }
}



/* Frost Nova Particles - Rushing Blue Ice */
.particle-frost {
    position: absolute;
    width: 10px;
    height: 10px;
    background: linear-gradient(135deg, #00bfff, #e0f7fa);
    box-shadow: 0 0 6px #00bfff;
    clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%);
    pointer-events: none;
    z-index: 32;
    opacity: 0;
}

@keyframes frost-particle-rush {
    0% {
        transform: translate(-50%, -50%) scale(0) rotate(0deg);
        opacity: 1;
    }

    100% {
        transform: translate(calc(-50% + var(--drift-x, 0px)), calc(-50% + var(--drift-y, 0px))) scale(2) rotate(var(--rotation, 360deg));
        opacity: 0;
    }
}

/* Armory Glow Effect */
@keyframes gold-pulse {
    0% {
        box-shadow: 0 0 5px var(--color-gold-light);
        border-color: var(--color-gold-light);
    }

    50% {
        box-shadow: 0 0 15px var(--color-gold-light), 0 0 5px var(--color-gold-base) inset;
        border-color: var(--color-gold-base);
    }

    100% {
        box-shadow: 0 0 5px var(--color-gold-light);
        border-color: var(--color-gold-light);
    }
}

.gold-glow {
    animation: gold-pulse 1.5s infinite ease-in-out !important;
    z-index: 10;
}

.hotkey-highlight {
    color: var(--color-gold-light) !important;
    font-weight: bold;
}


/* Settings Row for Sliders */
.settings-row {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    width: 100%;
    margin-bottom: 10px;
}

.setting-item.half-width {
    flex: 1;
    min-width: 0;
    /* Flexbox fix */
    margin-bottom: 0;
}

.setting-item.half-width input[type="range"] {
    width: 100%;
}

/* Mobile Hotkeys */
@media (max-width: 768px),
(pointer: coarse) {
    .hotkey-highlight {
        color: inherit !important;
        font-weight: inherit !important;
    }
}

/* Consolidated layout handled above in main blocks */

@media (hover: none) and (pointer: coarse) {

    /* Mobile: Scale Juggernaut down to normal size (not scaled up) */
    .unit.orc_juggernaut {
        transform: translateZ(10px) scale(1.0) !important;
    }

    /* Mobile Map Zoom - Apply zoom ONLY to the map container, not the entire overlay */
    /* This prevents the bottom panel from growing too large */

    /* Reduce bottom panel size on mobile */
    #level-select-screen .level-select-controls {
        max-height: 120px !important;
        padding: 8px 10px !important;
        gap: 8px !important;
    }

    #level-select-screen .level-select-controls button {
        padding: 8px 12px !important;
        font-size: 0.9rem !important;
    }

    /* Enable the map to pan further on zoomed views */
    .level-dot {
        transform: translate(-50%, -50%);
        /* Make dots bigger for easier tapping */
    }
}

/* Mobile Full-Screen Overlays */
@media (max-width: 768px) {

    #leaderboard-overlay .overlay-content,
    #achievements-overlay .overlay-content,
    #settings-overlay .overlay-content,
    #menu-overlay .overlay-content,
    #naked-challenge-overlay .overlay-content {
        background-color: transparent !important;
        width: 92% !important;
        height: auto !important;
        max-height: 92% !important;
        min-height: 200px !important;
        border-radius: 12px !important;
        margin: auto !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        position: fixed !important;
        display: flex;
        flex-direction: column;
        border: 2px solid var(--color-gold-dark) !important;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.8) !important;
    }

    /* Mobile HUD Overlap Fix */
    .nav-top-row {
        gap: 2px !important;
        padding: 0 2px 2px 2px !important;
    }

    #level-display,
    .side-panel-gold {
        font-size: 0.8rem !important;
        padding: 0.2rem 0.3rem !important;
    }

    .side-panel-gold .icon-menu {
        width: 14px !important;
        height: 14px !important;
        min-width: 14px !important;
        margin-right: 2px !important;
    }

    /* Level Complete: 100% width and less padding on mobile as requested */
    #level-complete-screen .overlay-content {
        background-color: transparent !important;
        width: 100% !important;
        height: auto !important;
        max-height: 95% !important;
        min-height: 200px !important;
        border-radius: 0 !important;
        margin: auto !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        position: fixed !important;
        display: flex;
        flex-direction: column;
        border: none !important;
        /* Remove border for 100% look */
        border-top: 2px solid var(--color-gold-dark) !important;
        border-bottom: 2px solid var(--color-gold-dark) !important;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.8) !important;
        padding: 5px !important;
        /* Less padding */
    }

    #leaderboard-overlay,
    #achievements-overlay {
        background-color: rgba(0, 0, 0, 0.6) !important;
    }

    /* Mobile Par HUD Integration */
    .hud-par-container {
        position: static !important;
        background: rgba(46, 30, 23, 0.9) !important;
        /* Match gold/ui-panel theme */
        border: 1px solid var(--color-gold-dark) !important;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6) !important;
        padding: 4px 8px !important;
        border-radius: 12px !important;
        gap: 6px !important;
        backdrop-filter: blur(6px) !important;
        margin-left: 4px;
        display: flex !important;
        height: min-content;
        align-self: center;
        /* Comfortable sizing */
        font-size: clamp(0.9rem, 1.8vmin, 1.2rem) !important;
        padding: 0.4em 0.3em !important;
        flex: 1 1 0 !important;
        /* Scale to fit */
        min-width: 0 !important;
        justify-content: center !important;
        /* Center content */
    }

    /* Fix HUD bars: Scale to fit all the way */
    #level-display,
    .side-panel-gold {
        flex: 1 1 0 !important;
        /* Fill width */
        width: auto !important;
        min-width: 0 !important;
        padding: 0.4em 0.3em !important;
        text-align: center !important;
        justify-content: center !important;
        /* Center flex content */
        font-size: clamp(1rem, 2vmin, 1.4rem) !important;
    }

    /* Force row layout and reduce size significantly */
    .level-complete-buttons {
        margin-top: 5px !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 15px !important;
        /* Align to right side */
        justify-content: flex-end !important;
        align-items: center !important;
    }

    /* Base style for both buttons (reset) */
    .level-complete-buttons #next-level-button,
    .level-complete-buttons #level-complete-shop-button,
    .level-complete-buttons button {
        padding: 0 !important;
        height: 44px !important;
        min-height: 44px !important;
        max-height: 44px !important;
        flex: 0 0 auto !important;
        max-width: none !important;
        border-radius: 8px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        margin: 0 !important;
        overflow: hidden !important;
        position: relative !important;
        /* Default to square, override for barracks */
        width: 44px !important;
        aspect-ratio: auto !important;
        /* Let width drive it */
    }

    /* Confirm Button (Icon-Icons): Perfect Square */
    .level-complete-buttons #next-level-button {
        width: 44px !important;
    }

    /* Barracks Button (Icon-Short): Wide Aspect Ratio */
    /* Icon is 1.5em wide, 0.9em high (5:3 ratio).
       If height is 44px, width should be ~73px. */
    .level-complete-buttons #level-complete-shop-button {
        width: 74px !important;
    }

    /*
       Flexbox Centering + Transform Scale.
    */
    /* 
       Flexbox Centering + Transform Scale.
    */
    /* Confirm Icon (Square 128x128) */
    .level-complete-buttons button .icon-icons,
    .level-complete-buttons button .large-icon:not(.icon-short) {
        width: 128px !important;
        height: 128px !important;
        min-width: 128px !important;
        min-height: 128px !important;
        transform: scale(0.3) !important;
        transform-origin: center center !important;
        margin: 0 !important;
        /* Rely on justify-content: center */
        display: block !important;
        position: static !important;
        flex: 0 0 auto !important;
    }

    /* Barracks Icon (Short/Wide 128x76.8) */
    .level-complete-buttons button .icon-short {
        width: 128px !important;
        height: 76.8px !important;
        /* 0.6 * 128 */
        min-width: 128px !important;
        min-height: 76.8px !important;
        /* Scale to fit 44px height. 76.8 * 0.57 ~= 43.7px */
        transform: scale(0.57) !important;
        transform-origin: center center !important;
        margin: 0 !important;
        /* Rely on justify-content: center */
        display: block !important;
        position: static !important;
        flex: 0 0 auto !important;
    }

    /* Soften drop shadows on these buttons for Mobile? NO, user wants them strong on mobile, soft on desktop. */
    /* So we REMOVE the mobile softening rule here, or explicitly set it to strong if base is soft. */
    .level-complete-buttons .dropshadow {
        /* Restore strong shadow for mobile */
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.9)) drop-shadow(0 0 2px rgba(0, 0, 0, 1)) !important;
    }

    /* Mobile Bonus Badges: Condense spacing */
    .bonus-item {
        padding: 2px 6px 1px 6px !important;
        /* Reduced bottom padding */
        margin: 1px !important;
        font-size: 0.85rem !important;
    }

    /* Remove gaps INSIDE the bonus item (between icon and text) */
    .bonus-item .bonus-icon {
        margin-bottom: 0 !important;
    }

    .bonus-item .bonus-value-container {
        margin-top: 0 !important;
    }

    #level-complete-bonuses,
    #stats-bonus-list {
        margin-bottom: 0 !important;
        /* No gap below list */
        padding-bottom: 0 !important;
    }

    /* "Gold Earned" text: User wanted padding BACK. So remove the override. */
    /* Removed #level-complete-stats > p:last-child rule */

    .hud-par-container .par-icon {
        font-size: 1.25em !important;
    }

    .hud-par-container .par-text {
        font-size: 1.1em !important;
    }

    .hud-par-container .par-bonus {
        font-size: 1em !important;
    }
}

.overlay-scroll-container {
    padding: 5px 15px !important;
}



/* Override Troops Tab Background to Match Shop/Armory */
#shop-troops-tab-content {
    /* background: linear-gradient(rgba(46, 30, 23, 0.9), rgba(30, 20, 15, 0.94)) !important; */
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    min-height: 520px;
}

/* MASTER OVERRIDE FOR TROOPS UI EXPANSION */
#shop-screen .troop-card,
.troop-card {
    width: 110px !important;
    height: auto !important;
    flex-shrink: 0 !important;
    flex-grow: 0 !important;
    gap: 4px !important;
    border: none !important;
    padding: 0 !important;
}

#shop-screen .troop-card .troop-card-visual,
.troop-card .troop-card-visual {
    width: 110px !important;
    height: 110px !important;
    box-sizing: border-box !important;
    border: none !important;
    border-radius: 0 !important;
    background-color: transparent !important;
    box-shadow: none !important;
    outline: none !important;

    background-image: var(--spritesheet-icons) !important;
    background-position: 75% 25% !important;
    /* Row 1, Col 3 */
    background-size: 500% 500% !important;

    display: flex;
    justify-content: center;
    align-items: center;
}



/* Global active tab icon highlighting */
.active-tab-icon {
    filter: drop-shadow(0 0 15px var(--color-gold-light)) brightness(1.4) !important;
    transform: scale(1.1);
}

/* Ensure pagination buttons are clickable */
#level-select-pagination {
    position: relative;
    z-index: 100;
    pointer-events: auto;
}

#level-select-pagination button {
    pointer-events: auto;
    z-index: 101;
}

/* Control Icon Size (Smaller than large icons) */
.control-icon {
    font-size: 3rem !important;
    /* ~48px */
    width: 48px !important;
    height: 48px !important;
}

.control-icon.icon-icons {
    width: 48px !important;
    height: 48px !important;
}

/* Duplicate Level Select block removed */

#back-to-main-menu-button {
    margin-right: auto;
}

/* Remove green background from Level Complete buttons */
#level-complete-screen .no-backdrop {
    background: none !important;
    box-shadow: none !important;
    border: none !important;
}

#level-complete-screen .no-backdrop:hover {
    background: none !important;
    transform: scale(1.1);
}

/* Shop Icons - Much Bigger */
.shop-tab-button .icon-short {
    width: 80px !important;
    height: 48px !important;
}

/* Achievement Icons - Specific Sprites from icons.png (4 cols x 5 rows) */
.achievement-icon[style*="achievement_locked"],
.achievement-item.locked .achievement-icon {
    background-image: url('./sprites/icons.png') !important;
    background-position: 0% 0% !important;
    /* Row 1, Col 1 */
    background-size: 500% 500% !important;
}

.achievement-item.unlocked .achievement-icon {
    background-image: url('./sprites/icons.png') !important;
    background-position: 25% 0% !important;
    /* Row 1, Col 2 -> Col 1 in 5-col */
    background-size: 500% 500% !important;
}

/* View Controls - Vertical Stack */
.view-controls-bar {
    flex-direction: column !important;
    gap: 15px;
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 100;
}

/* Force Level Select Bottom Bar Alignment */
/* FLOATING PAGINATION - ABOVE BOTTOM BUTTONS */
#level-select-pagination {
    position: absolute !important;
    bottom: 70px !important;
    /* Above the Back/Barracks buttons */
    left: 0 !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    gap: 20px !important;
    z-index: 100 !important;
    pointer-events: none;
    /* Let clicks pass through */
    background: transparent !important;
}

#level-select-pagination.hidden {
    display: none !important;
}

#level-select-pagination button {
    pointer-events: auto !important;
    z-index: 101 !important;
}

#level-select-pagination span {
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    font-weight: bold;
    color: var(--color-gold-light);
}

/* Force Level Select Bottom Bar Alignment - ABSOLUTE POSITIONING */
.level-select-bottom-bar {
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    /* Center the Barracks button */
    align-items: flex-end !important;
    padding: 10px 20px !important;
    box-sizing: border-box !important;
    background: transparent !important;
    /* Fully transparent */
    border: none !important;
    /* Remove .bottom-bar-style border */
    box-shadow: none !important;
    /* Remove .bottom-bar-style shadow */
    pointer-events: none;
    /* Let clicks pass through empty space */
    z-index: 1000 !important;
}

.level-select-bottom-bar button {
    pointer-events: auto !important;
    margin: 0 !important;
    /* Reset all margins */
}

#back-to-main-menu-button {
    position: absolute !important;
    left: 10px !important;
    bottom: 10px !important;
}

/* Scale back-button icon to match barracks/icon-short size */
#back-to-main-menu-button .large-icon.icon-icons {
    width: 128px !important;
    height: 128px !important;
    min-width: 128px !important;
    max-width: 128px !important;
    background-size: 500% 500% !important;
    transform: scale(0.5) !important;
    transform-origin: center center !important;
    margin: -32px !important;
    /* (128 - 64) / 2 = 32px reclaimed */
}

/* Styles handled by parent flex container now */

/* Remove green background from Level Complete buttons */
#level-complete-screen .no-backdrop {
    background: transparent !important;
    box-shadow: none !important;
    border: none !important;
    transition: transform 0.2s ease;
}

#level-complete-screen .no-backdrop:hover {
    background: transparent !important;
    /* Ensure NO background on hover */
    transform: scale(1.1);
}

/* Shop Icons - Much Bigger */
.shop-tab-button .icon-short {
    width: 80px !important;
    height: 48px !important;
}

/* Achievement Icons - Row 1 (Index 1 -> 25% Y) */
/* Locked: Col 1 (Index 1 -> 33.333% X) */
.achievement-icon[style*="achievement_locked"],
.achievement-item.locked .achievement-icon {
    background-image: url('./sprites/icons.png') !important;
    background-position: 25% 25% !important;
    background-size: 500% 500% !important;
}

/* Unlocked: Col 2 (Index 2 -> 50% X) */
.achievement-item.unlocked .achievement-icon {
    background-image: url('./sprites/icons.png') !important;
    background-position: 50% 25% !important;
    background-size: 500% 500% !important;
}

/* View Controls - Vertical Stack */
.view-controls-bar {
    flex-direction: column !important;
    gap: 15px;
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 100;
}

/* --- Totem Visual Feedback --- */

.totem-glow-green {
    animation: totem-activation-glow-green 1s ease-out forwards;
    pointer-events: none;
    z-index: 5;
}

@keyframes totem-activation-glow-green {
    0% {
        box-shadow: inset 0 0 0 0px rgba(0, 255, 0, 0);
        background-color: rgba(0, 255, 0, 0);
    }

    10% {
        box-shadow: inset 0 0 15px 5px rgba(0, 255, 0, 0.6);
        background-color: rgba(0, 255, 0, 0.2);
    }

    100% {
        box-shadow: inset 0 0 0 0px rgba(0, 255, 0, 0);
        background-color: rgba(0, 255, 0, 0);
    }
}

.unit-glow-red::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: inherit;
    -webkit-mask: inherit;
    mask: inherit;
    animation: unit-glow-red-anim 0.8s ease-out forwards !important;
    pointer-events: none;
    z-index: 1;
}

@keyframes unit-glow-red-anim {
    0% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 0px rgba(255, 0, 0, 0));
    }

    20% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 12px rgba(255, 0, 0, 1));
    }

    100% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 0px rgba(255, 0, 0, 0));
    }
}

.unit-glow-purple::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: inherit;
    -webkit-mask: inherit;
    mask: inherit;
    animation: unit-glow-purple-anim 0.8s ease-out forwards !important;
    pointer-events: none;
    z-index: 1;
}

@keyframes unit-glow-purple-anim {
    0% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 0px rgba(147, 51, 234, 0));
    }

    20% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 12px rgba(147, 51, 234, 1));
    }

    100% {
        filter: var(--unit-base-shadow) drop-shadow(0 0 0px rgba(147, 51, 234, 0));
    }
}

.stat-boosted {
    color: #4ade80 !important;
    /* Green */
    text-shadow: 0 0 5px rgba(74, 222, 128, 0.5);
}

.stat-debuffed {
    color: #f87171 !important;
    /* Red */
    text-shadow: 0 0 5px rgba(248, 113, 113, 0.5);
}

.grid-cell.frost-nova-warning {
    background-color: transparent !important;
    box-shadow: inset 0 0 0 2px rgba(0, 191, 255, 0.6), 0 0 6px 1px rgba(0, 191, 255, 0.4);
    animation: frost-nova-pulse 1s ease-in-out infinite;
    transition: none;
    z-index: 5;
}

@keyframes frost-nova-pulse {

    0%,
    100% {
        box-shadow: inset 0 0 0 2px rgba(0, 162, 255, 0.616), 0 0 4px 1px rgba(0, 191, 255, 0.2);
    }

    50% {
        box-shadow: inset 0 0 0 2px rgb(100, 149, 255), 0 0 10px 3px rgba(100, 220, 255, 0.6);
    }
}

/* FINAL DEFINITIVE OVERRIDE FOR PASSIVE SKILLS - Force Skills.png and 5x3 Grid sizing */
.icon.icon-shop.icon-skill-tacticalcommand {
    background: url('./sprites/skills.png') 25% 50% / 500% 300% no-repeat !important;
}

.icon.icon-shop.icon-skill-loothoarder {
    background: url('./sprites/skills.png') 50% 50% / 500% 300% no-repeat !important;
}

.icon.icon-shop.icon-skill-evasion {
    background: url('./sprites/skills.png') 75% 50% / 500% 300% no-repeat !important;
}

.icon.icon-shop.icon-skill-thorns {
    background: url('./sprites/skills.png') 100% 50% / 500% 300% no-repeat !important;
}

.icon.icon-shop.icon-skill-vampiricaura {
    background: url('./sprites/skills.png') 0% 100% / 500% 300% no-repeat !important;
}

.icon.icon-shop.icon-skill-goldmagnet {
    background: url('./sprites/skills.png') 25% 100% / 500% 300% no-repeat !important;
}